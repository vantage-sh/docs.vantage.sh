"use strict";(self.webpackChunkdocs_vantage_sh=self.webpackChunkdocs_vantage_sh||[]).push([[5563],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>f});var o=r(7294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},a=Object.keys(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var l=o.createContext({}),u=function(e){var t=o.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):s(s({},t),e)),r},c=function(e){var t=u(e.components);return o.createElement(l.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},y=o.forwardRef((function(e,t){var r=e.components,n=e.mdxType,a=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),p=u(r),y=n,f=p["".concat(l,".").concat(y)]||p[y]||d[y]||a;return r?o.createElement(f,s(s({ref:t},c),{},{components:r})):o.createElement(f,s({ref:t},c))}));function f(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var a=r.length,s=new Array(a);s[0]=y;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[p]="string"==typeof e?e:n,s[1]=i;for(var u=2;u<a;u++)s[u]=r[u];return o.createElement.apply(null,s)}return o.createElement.apply(null,r)}y.displayName="MDXCreateElement"},1312:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>a,metadata:()=>i,toc:()=>u});var o=r(7462),n=(r(7294),r(3905));const a={id:"snowflake_cost_by_query",title:"Snowflake Costs per Query",description:"Calculate your Snowflake cost per query in Vantage.",keywords:["Snowflake","Snowflake cost per query"]},s="Snowflake Costs per Query",i={unversionedId:"snowflake_cost_by_query",id:"snowflake_cost_by_query",title:"Snowflake Costs per Query",description:"Calculate your Snowflake cost per query in Vantage.",source:"@site/docs/snowflake_cost_by_query.md",sourceDirName:".",slug:"/snowflake_cost_by_query",permalink:"/snowflake_cost_by_query",draft:!1,editUrl:"https://github.com/vantage-sh/docs.vantage.sh/blob/master/docs/snowflake_cost_by_query.md",tags:[],version:"current",frontMatter:{id:"snowflake_cost_by_query",title:"Snowflake Costs per Query",description:"Calculate your Snowflake cost per query in Vantage.",keywords:["Snowflake","Snowflake cost per query"]},sidebar:"someSidebar",previous:{title:"Snowflake",permalink:"/connecting_snowflake"},next:{title:"Databricks",permalink:"/connecting_databricks"}},l={},u=[{value:"How It Works",id:"how-it-works",level:2},{value:"Grouping Queries",id:"grouping-queries",level:2},{value:"Viewing the Costs",id:"viewing-the-costs",level:2},{value:"Query Costs in Cost Reports",id:"query-costs-in-cost-reports",level:3},{value:"Query Costs in Active Resources View",id:"query-costs-in-active-resources-view",level:3},{value:"Security",id:"security",level:2}],c={toc:u},p="wrapper";function d(e){let{components:t,...r}=e;return(0,n.kt)(p,(0,o.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"snowflake-costs-per-query"},"Snowflake Costs per Query"),(0,n.kt)("p",null,"Vantage calculates a weighted cost per query by breaking down the use of Snowflake ",(0,n.kt)("a",{parentName:"p",href:"https://docs.snowflake.com/en/user-guide/credits.html#virtual-warehouse-credit-usage"},"compute credits"),". This allows users to easily identify the most expensive queries."),(0,n.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,n.kt)("img",{alt:"Snowflake cost per query",width:"80%",src:"/img/snowflake_queries.png"})),(0,n.kt)("h2",{id:"how-it-works"},"How It Works"),(0,n.kt)("p",null,"Snowflake Compute is billed only when a query is running, rounded up to the hour; however, if multiple queries are running simultaneously, the cost is still only reported for that hour. This shared credit pool makes it difficult to understand which individual queries are contributing the most to costs."),(0,n.kt)("p",null,"Each day, Vantage ingests the compute credits used, and their equivalent cost, and assigns a weighted cost to each query based on the total duration for which the query ran. For example, if you had 3 queries that ran for 1, 2, and 3 minutes respectively, and a total bill of $500, the query that ran for 3 minutes would be assigned a cost of $250 as it accounted for half of the overall query time."),(0,n.kt)("h2",{id:"grouping-queries"},"Grouping Queries"),(0,n.kt)("p",null,"Vantage groups queries based on the source and structure of a query, so users can easily identify it. To determine the source, Vantage looks at the warehouse in which the query was run as well as the user who ran the query. To determine the structure of a query, Vantage will strip all query values and the order of columns and generate a normalized, unique fingerprint for the query."),(0,n.kt)("h2",{id:"viewing-the-costs"},"Viewing the Costs"),(0,n.kt)("p",null,"Query costs are available in two views: on Cost Reports and in Active Resources. "),(0,n.kt)("h3",{id:"query-costs-in-cost-reports"},"Query Costs in Cost Reports"),(0,n.kt)("p",null,"To view query costs on a ",(0,n.kt)("a",{parentName:"p",href:"/cost_reports/"},"Cost Report"),":"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"In the console, navigate to ",(0,n.kt)("a",{parentName:"li",href:"https://console.vantage.sh/reporting"},"Cost Reports"),"."),(0,n.kt)("li",{parentName:"ol"},"Create a new report and add a provider filter for ",(0,n.kt)("strong",{parentName:"li"},"Snowflake"),"."),(0,n.kt)("li",{parentName:"ol"},"Click the ",(0,n.kt)("strong",{parentName:"li"},"Cost by Resource")," icon next to the ",(0,n.kt)("strong",{parentName:"li"},"Snowflake Data Cloud")," line item and see a paginated list of each query, as well as a day-by-day breakdown of that query's costs. ")),(0,n.kt)("h3",{id:"query-costs-in-active-resources-view"},"Query Costs in Active Resources View"),(0,n.kt)("p",null,"To view query costs in the ",(0,n.kt)("a",{parentName:"p",href:"/active_resources"},"Active Resources")," view:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Navigate to the ",(0,n.kt)("a",{parentName:"li",href:"https://console.vantage.sh/services/snowflake_queries/resources"},"Active Resources page")," in the console. "),(0,n.kt)("li",{parentName:"ol"},"Select ",(0,n.kt)("strong",{parentName:"li"},"Snowflake Query")," and see a list of active queries, as well as their associated costs. Queries are considered active if they have incurred costs in the past 30 days and are in the top 1,000 queries by cost for that account. ")),(0,n.kt)("h2",{id:"security"},"Security"),(0,n.kt)("p",null,"Vantage ensures that any sensitive data contained in queries is never stored in Vantage systems. When the ",(0,n.kt)("inlineCode",{parentName:"p"},"QUERY_HISTORY")," view is queried from Snowflake, that data is immediately processed to strip all values from queries before they are stored."))}d.isMDXComponent=!0}}]);