"use strict";(self.webpackChunkdocs_vantage_sh=self.webpackChunkdocs_vantage_sh||[]).push([[4098],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>k});var r=a(7294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},l=Object.keys(e);for(r=0;r<l.length;r++)a=l[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)a=l[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var i=r.createContext({}),c=function(e){var t=r.useContext(i),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},u=function(e){var t=c(e.components);return r.createElement(i.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,l=e.originalType,i=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=c(a),m=n,k=p["".concat(i,".").concat(m)]||p[m]||d[m]||l;return a?r.createElement(k,o(o({ref:t},u),{},{components:a})):r.createElement(k,o({ref:t},u))}));function k(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var l=a.length,o=new Array(l);o[0]=m;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s[p]="string"==typeof e?e:n,o[1]=s;for(var c=2;c<l;c++)o[c]=a[c];return r.createElement.apply(null,o)}return r.createElement.apply(null,a)}m.displayName="MDXCreateElement"},5162:(e,t,a)=>{a.d(t,{Z:()=>o});var r=a(7294),n=a(6010);const l={tabItem:"tabItem_Ymn6"};function o(e){let{children:t,hidden:a,className:o}=e;return r.createElement("div",{role:"tabpanel",className:(0,n.Z)(l.tabItem,o),hidden:a},t)}},4866:(e,t,a)=>{a.d(t,{Z:()=>b});var r=a(7462),n=a(7294),l=a(6010),o=a(2466),s=a(6550),i=a(1980),c=a(7392),u=a(12);function p(e){return function(e){return n.Children.map(e,(e=>{if((0,n.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))}(e).map((e=>{let{props:{value:t,label:a,attributes:r,default:n}}=e;return{value:t,label:a,attributes:r,default:n}}))}function d(e){const{values:t,children:a}=e;return(0,n.useMemo)((()=>{const e=t??p(a);return function(e){const t=(0,c.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,a])}function m(e){let{value:t,tabValues:a}=e;return a.some((e=>e.value===t))}function k(e){let{queryString:t=!1,groupId:a}=e;const r=(0,s.k6)(),l=function(e){let{queryString:t=!1,groupId:a}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!a)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return a??null}({queryString:t,groupId:a});return[(0,i._X)(l),(0,n.useCallback)((e=>{if(!l)return;const t=new URLSearchParams(r.location.search);t.set(l,e),r.replace({...r.location,search:t.toString()})}),[l,r])]}function g(e){const{defaultValue:t,queryString:a=!1,groupId:r}=e,l=d(e),[o,s]=(0,n.useState)((()=>function(e){let{defaultValue:t,tabValues:a}=e;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!m({value:t,tabValues:a}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${a.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const r=a.find((e=>e.default))??a[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:t,tabValues:l}))),[i,c]=k({queryString:a,groupId:r}),[p,g]=function(e){let{groupId:t}=e;const a=function(e){return e?`docusaurus.tab.${e}`:null}(t),[r,l]=(0,u.Nk)(a);return[r,(0,n.useCallback)((e=>{a&&l.set(e)}),[a,l])]}({groupId:r}),v=(()=>{const e=i??p;return m({value:e,tabValues:l})?e:null})();(0,n.useLayoutEffect)((()=>{v&&s(v)}),[v]);return{selectedValue:o,selectValue:(0,n.useCallback)((e=>{if(!m({value:e,tabValues:l}))throw new Error(`Can't select invalid tab value=${e}`);s(e),c(e),g(e)}),[c,g,l]),tabValues:l}}var v=a(2389);const N={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function h(e){let{className:t,block:a,selectedValue:s,selectValue:i,tabValues:c}=e;const u=[],{blockElementScrollPositionUntilNextRender:p}=(0,o.o5)(),d=e=>{const t=e.currentTarget,a=u.indexOf(t),r=c[a].value;r!==s&&(p(t),i(r))},m=e=>{let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const a=u.indexOf(e.currentTarget)+1;t=u[a]??u[0];break}case"ArrowLeft":{const a=u.indexOf(e.currentTarget)-1;t=u[a]??u[u.length-1];break}}t?.focus()};return n.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.Z)("tabs",{"tabs--block":a},t)},c.map((e=>{let{value:t,label:a,attributes:o}=e;return n.createElement("li",(0,r.Z)({role:"tab",tabIndex:s===t?0:-1,"aria-selected":s===t,key:t,ref:e=>u.push(e),onKeyDown:m,onClick:d},o,{className:(0,l.Z)("tabs__item",N.tabItem,o?.className,{"tabs__item--active":s===t})}),a??t)})))}function f(e){let{lazy:t,children:a,selectedValue:r}=e;if(a=Array.isArray(a)?a:[a],t){const e=a.find((e=>e.props.value===r));return e?(0,n.cloneElement)(e,{className:"margin-top--md"}):null}return n.createElement("div",{className:"margin-top--md"},a.map(((e,t)=>(0,n.cloneElement)(e,{key:t,hidden:e.props.value!==r}))))}function y(e){const t=g(e);return n.createElement("div",{className:(0,l.Z)("tabs-container",N.tabList)},n.createElement(h,(0,r.Z)({},e,t)),n.createElement(f,(0,r.Z)({},e,t)))}function b(e){const t=(0,v.Z)();return n.createElement(y,(0,r.Z)({key:String(t)},e))}},9177:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>u,contentTitle:()=>i,default:()=>k,frontMatter:()=>s,metadata:()=>c,toc:()=>p});var r=a(7462),n=(a(7294),a(3905)),l=a(4866),o=a(5162);const s={id:"vql",title:"VQL (Vantage Query Language)",description:"This page walks through the Vantage Query Language, or VQL, use for filter criteria on the Vantage API and with the Vantage Terraform provider.",keywords:["VQL","Vantage Query Language","Terraform"]},i="VQL (Vantage Query Language)",c={unversionedId:"vql",id:"vql",title:"VQL (Vantage Query Language)",description:"This page walks through the Vantage Query Language, or VQL, use for filter criteria on the Vantage API and with the Vantage Terraform provider.",source:"@site/docs/vql.md",sourceDirName:".",slug:"/vql",permalink:"/vql",draft:!1,editUrl:"https://github.com/vantage-sh/docs.vantage.sh/blob/master/docs/vql.md",tags:[],version:"current",frontMatter:{id:"vql",title:"VQL (Vantage Query Language)",description:"This page walks through the Vantage Query Language, or VQL, use for filter criteria on the Vantage API and with the Vantage Terraform provider.",keywords:["VQL","Vantage Query Language","Terraform"]},sidebar:"someSidebar",previous:{title:"Terraform Provider",permalink:"/terraform"},next:{title:"Data Dictionary",permalink:"/data_dictionary"}},u={},p=[{value:"Key Concepts",id:"key-concepts",level:2},{value:"Schema",id:"schema",level:3},{value:"Keywords",id:"keywords",level:3},{value:"Syntax",id:"syntax",level:3},{value:"VQL Examples",id:"examples",level:2},{value:"Combining Providers",id:"providers",level:3},{value:"Cost Allocation",id:"cost-allocation",level:3},{value:"Costs from a List of Regions",id:"region",level:3},{value:"Get Marketplace Transactions",id:"marketplace",level:3},{value:"Costs by Account ID",id:"account",level:3},{value:"Costs by Provider Account ID",id:"provider-account",level:3},{value:"Per-Resource Costs and Costs by Service",id:"resource",level:3},{value:"Multiple Resource IDs",id:"multiple-resource-ids",level:4},{value:"Costs by Specific Category",id:"category",level:3},{value:"Costs by Specific Subcategory",id:"subcategory",level:3},{value:"Filter by Tag",id:"tags",level:3},{value:"Filter by Single Tag",id:"filter-by-single-tag",level:4},{value:"Filter by Multiple Tags",id:"multiple-tags",level:4},{value:"Filter for Matching Tags Using <code>LIKE</code>",id:"filter-for-matching-tags-using-like",level:4},{value:"Filter for Untagged Resources",id:"untagged",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2}],d={toc:p},m="wrapper";function k(e){let{components:t,...a}=e;return(0,n.kt)(m,(0,r.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"vql-vantage-query-language"},"VQL (Vantage Query Language)"),(0,n.kt)("p",null,"The Vantage Query Language (VQL) is a SQL-like language for filtering cloud cost data. It includes a normalized schema across cloud providers and basic filter syntax for creating complex filters. VQL is currently available as part of the ",(0,n.kt)("a",{parentName:"p",href:"https://vantage.readme.io/reference/general"},"Vantage API")," as well as within the ",(0,n.kt)("a",{parentName:"p",href:"/terraform"},"Vantage Terraform provider"),"."),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"API"),". On supported endpoints, such as ",(0,n.kt)("inlineCode",{parentName:"li"},"/cost_reports"),", you can use VQL in the ",(0,n.kt)("inlineCode",{parentName:"li"},"filter")," parameter to programmatically create and fetch Cost Reports."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"Terraform provider"),". In supported Terraform resources, such as ",(0,n.kt)("inlineCode",{parentName:"li"},"vantage_saved_filter")," or ",(0,n.kt)("inlineCode",{parentName:"li"},"vantage_cost_report"),", you can use VQL for the ",(0,n.kt)("inlineCode",{parentName:"li"},"filter")," argument to create filtered Cost Reports or saved filters.")),(0,n.kt)("p",null,"The below examples show how to use VQL on both the API as well as on the Terraform provider. This example creates a ",(0,n.kt)("a",{parentName:"p",href:"/cost_reports#saved-filters"},"saved filter")," in your Vantage account using VQL."),(0,n.kt)(l.Z,{mdxType:"Tabs"},(0,n.kt)(o.Z,{value:"api",label:"API",mdxType:"TabItem"},(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},'curl --request POST \\\n     --url https://api.vantage.sh/v2/saved_filters \\\n     --header \'content-type: application/json\' \\\n     --header \'authorization: Bearer <ACCESS_TOKEN>\' \\\n     --data @- <<EOF\n{\n  "filter": "(costs.provider = \'aws\' AND costs.service = \'Amazon Relational Database Service\') OR (costs.provider = \'kubernetes\')",\n  "title": "RDS and Kubernetes",\n  "workspace_token": "wrkspc_abcde12345"\n}\nEOF\n'))),(0,n.kt)(o.Z,{value:"terraform",label:"Terraform Provider",mdxType:"TabItem"},(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-hcl"},'resource "vantage_saved_filter" "rds_kubernetes" {\n  title  = "RDS and Kubernetes"\n  filter = "(costs.provider = \'aws\' AND costs.service = \'Amazon Relational Database Service\') OR (costs.provider = \'kubernetes\')"\n  workspace_token = "wrkspc_abcde1234"\n}\n')))),(0,n.kt)("hr",null),(0,n.kt)("h2",{id:"key-concepts"},"Key Concepts"),(0,n.kt)("p",null,"VQL is based on the following key concepts, further described in subsequent sections."),(0,n.kt)(l.Z,{mdxType:"Tabs"},(0,n.kt)(o.Z,{value:"schema",label:"Schema",mdxType:"TabItem"},(0,n.kt)("p",null,"VQL uses a schema that organizes filters into namespaces. These namespaces comprise various fields that you can leverage to filter and retrieve specific cost-related data.")),(0,n.kt)(o.Z,{value:"keywords",label:"Keywords",mdxType:"TabItem"},(0,n.kt)("p",null,"VQL includes keywords, like ",(0,n.kt)("inlineCode",{parentName:"p"},"AND"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"OR"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"IN"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"LIKE"),", and ",(0,n.kt)("inlineCode",{parentName:"p"},"NOT"),", to create complex and precise filter conditions.")),(0,n.kt)(o.Z,{value:"syntax",label:"Syntax",mdxType:"TabItem"},(0,n.kt)("p",null,"VQL syntax closely resembles the ",(0,n.kt)("inlineCode",{parentName:"p"},"WHERE")," clause of a SQL query. You can construct filter operations to extract desired cost insights."))),(0,n.kt)("hr",null),(0,n.kt)("h3",{id:"schema"},"Schema"),(0,n.kt)("p",null,"VQL comprises two namespaces, ",(0,n.kt)("inlineCode",{parentName:"p"},"costs")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"tags"),", which represent the available ",(0,n.kt)("a",{parentName:"p",href:"/cost_reports#filtering-cost-reports"},"filters")," on Cost Reports in the Vantage console. To reference a filter, use the following syntax: ",(0,n.kt)("inlineCode",{parentName:"p"},"namespace.field")," (e.g., ",(0,n.kt)("inlineCode",{parentName:"p"},"costs.provider")," or ",(0,n.kt)("inlineCode",{parentName:"p"},"tags.name"),")."),(0,n.kt)("table",{style:{width:"100%"}},(0,n.kt)("thead",null,(0,n.kt)("tr",null,(0,n.kt)("th",{style:{width:"33%"}},"Namespace"),(0,n.kt)("th",{style:{width:"33%"}},"Field"),(0,n.kt)("th",{style:{width:"33%"}},"VQL Example"))),(0,n.kt)("tbody",null,(0,n.kt)("tr",null,(0,n.kt)("td",{rowspan:"10",style:{textAlign:"center"}},(0,n.kt)("code",null,"costs")),(0,n.kt)("td",null,(0,n.kt)("code",null,"provider")),(0,n.kt)("td",null,(0,n.kt)("a",{href:"#providers"},"Providers example"))),(0,n.kt)("tr",null,(0,n.kt)("td",null,(0,n.kt)("code",null,"allocation")),(0,n.kt)("td",null,(0,n.kt)("a",{href:"#cost-allocation"},"Cost allocation example"))),(0,n.kt)("tr",null,(0,n.kt)("td",null,(0,n.kt)("code",null,"region")),(0,n.kt)("td",null,(0,n.kt)("a",{href:"#region"},"Region example"))),(0,n.kt)("tr",null,(0,n.kt)("td",null,(0,n.kt)("code",null,"marketplace")),(0,n.kt)("td",null,(0,n.kt)("a",{href:"#marketplace"},"Marketplace example"))),(0,n.kt)("tr",null,(0,n.kt)("td",null,(0,n.kt)("code",null,"account_id")),(0,n.kt)("td",null,(0,n.kt)("a",{href:"#account"},"Account ID example"))),(0,n.kt)("tr",null,(0,n.kt)("td",null,(0,n.kt)("code",null,"provider_account_id")),(0,n.kt)("td",null,(0,n.kt)("a",{href:"#provider-account"},"Provider account ID example"))),(0,n.kt)("tr",null,(0,n.kt)("td",null,(0,n.kt)("code",null,"service")),(0,n.kt)("td",null,(0,n.kt)("a",{href:"#resource"},"Service example"))),(0,n.kt)("tr",null,(0,n.kt)("td",null,(0,n.kt)("code",null,"category")),(0,n.kt)("td",null,(0,n.kt)("a",{href:"#category"},"Category example"))),(0,n.kt)("tr",null,(0,n.kt)("td",null,(0,n.kt)("code",null,"subcategory")),(0,n.kt)("td",null,(0,n.kt)("a",{href:"#subcategory"},"Subcategory example"))),(0,n.kt)("tr",null,(0,n.kt)("td",null,(0,n.kt)("code",null,"resource_id")),(0,n.kt)("td",null,(0,n.kt)("a",{href:"#resource"},"Resource example"))),(0,n.kt)("tr",null,(0,n.kt)("td",{rowspan:"2",style:{textAlign:"center"}},(0,n.kt)("code",null,"tags")),(0,n.kt)("td",null,(0,n.kt)("code",null,"name")),(0,n.kt)("td",{rowspan:"2"},(0,n.kt)("ul",null,(0,n.kt)("li",null,(0,n.kt)("a",{href:"#tags"},"Tags name/value example")),(0,n.kt)("li",null,(0,n.kt)("a",{href:"#untagged"},"Untagged example"))))),(0,n.kt)("tr",null,(0,n.kt)("td",null,(0,n.kt)("code",null,"value"))))),(0,n.kt)("admonition",{type:"note"},(0,n.kt)("p",{parentName:"admonition"},"Availability of the fields listed above varies among different cloud providers. For a comprehensive list of available fields per provider, see the ",(0,n.kt)("a",{parentName:"p",href:"/data_dictionary"},"Data Dictionary"),".")),(0,n.kt)("h3",{id:"keywords"},"Keywords"),(0,n.kt)("p",null,"VQL includes a set of keywords to create complex filter conditions. These keywords function similar to their SQL equivalents."),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"Keyword"),(0,n.kt)("th",{parentName:"tr",align:null},"Description"),(0,n.kt)("th",{parentName:"tr",align:null},"VQL Sample"),(0,n.kt)("th",{parentName:"tr",align:null},"Explanation"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"AND")),(0,n.kt)("td",{parentName:"tr",align:null},"Logical AND operator"),(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"costs.provider = 'aws' AND costs.service = 'EC2'")),(0,n.kt)("td",{parentName:"tr",align:null},"This example filters AWS costs for the EC2 service, where both conditions must be true.")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"OR")),(0,n.kt)("td",{parentName:"tr",align:null},"Logical OR operator"),(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"costs.provider = 'azure' OR costs.provider = 'aws'")),(0,n.kt)("td",{parentName:"tr",align:null},"This example retrieves costs from either Azure or AWS. At least one condition must be true.")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"IN")),(0,n.kt)("td",{parentName:"tr",align:null},"Used to compare against an array list"),(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"costs.provider = 'azure' AND costs.account_id IN ('account-1', 'account-2')")),(0,n.kt)("td",{parentName:"tr",align:null},"This example filters based on a list of account IDs, returning data for the specified accounts",(0,n.kt)("br",null),(0,n.kt)("br",null),"You can also use ",(0,n.kt)("inlineCode",{parentName:"td"},"IN")," along with a special syntax for filtering by multiple tags. See ",(0,n.kt)("a",{parentName:"td",href:"/vql#multiple-tags"},"Filter by Multiple Tags")," for details.")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"LIKE")),(0,n.kt)("td",{parentName:"tr",align:null},"Performs string comparisons"),(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"costs.provider = 'gcp' AND tags.name = 'environment' AND tags.value LIKE '%prod%'")),(0,n.kt)("td",{parentName:"tr",align:null},"This example selects data where the tag value contains ",(0,n.kt)("inlineCode",{parentName:"td"},"prod"),", such as ",(0,n.kt)("inlineCode",{parentName:"td"},"production-1"),". ",(0,n.kt)("br",null)," Note that at this time, ",(0,n.kt)("inlineCode",{parentName:"td"},"LIKE")," is not compatible with ",(0,n.kt)("inlineCode",{parentName:"td"},"costs.account_id"),", ",(0,n.kt)("inlineCode",{parentName:"td"},"costs.provider_account_id"),", ",(0,n.kt)("inlineCode",{parentName:"td"},"costs.region"),", and ",(0,n.kt)("inlineCode",{parentName:"td"},"costs.service"),".")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"NOT")),(0,n.kt)("td",{parentName:"tr",align:null},"Represents negation"),(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"costs.provider = 'aws' AND costs.region NOT IN ('us-east-1', 'us-east-2')")),(0,n.kt)("td",{parentName:"tr",align:null},"This example filters out data from both specified regions, providing all AWS costs ",(0,n.kt)("em",{parentName:"td"},"not")," in these regions. Use ",(0,n.kt)("inlineCode",{parentName:"td"},"NOT IN")," to specify a list of single or multiple values. ",(0,n.kt)("br",null),(0,n.kt)("br",null)," You can also use the ",(0,n.kt)("inlineCode",{parentName:"td"},"!=")," or ",(0,n.kt)("inlineCode",{parentName:"td"},"<>"),' operators for "is not." ',(0,n.kt)("br",null),(0,n.kt)("br",null)," ",(0,n.kt)("inlineCode",{parentName:"td"},"costs.provider = 'aws' AND costs.region != 'us-east-1'"),(0,n.kt)("br",null),(0,n.kt)("br",null),"You can use ",(0,n.kt)("inlineCode",{parentName:"td"},"NOT LIKE")," to perform string comparisons:",(0,n.kt)("br",null),(0,n.kt)("br",null),(0,n.kt)("inlineCode",{parentName:"td"},"costs.provider = 'gcp' AND tags.name = 'environment' AND tags.value NOT LIKE '%prod%'"))))),(0,n.kt)("p",null,"With these keywords, you can construct complex filter conditions in VQL, providing flexibility and precision when querying and analyzing cloud cost data."),(0,n.kt)("h3",{id:"syntax"},"Syntax"),(0,n.kt)("p",null,"You can think of VQL in its current iteration as the ",(0,n.kt)("inlineCode",{parentName:"p"},"WHERE")," clause of a SQL query. By combining the schema and keywords above with parentheses, you can form complex filter operations, such as:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"costs.provider = 'mongo' AND costs.allocation = 1.0 AND (costs.service = 'REALM' AND costs.resource_id IN ('s3')) OR (costs.provider = 'aws' AND costs.allocation = 1.0 AND costs.account_id IN ('123456798'))\n")),(0,n.kt)("h2",{id:"examples"},"VQL Examples"),(0,n.kt)("p",null,"The following examples cover common use cases for VQL."),(0,n.kt)("h3",{id:"providers"},"Combining Providers"),(0,n.kt)("p",null,"Filter for provider costs associated with either MongoDB Atlas or AWS."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"costs.provider = 'mongo' OR costs.provider = 'aws'\n")),(0,n.kt)("h3",{id:"cost-allocation"},"Cost Allocation"),(0,n.kt)("p",null,"Set cost allocation to ",(0,n.kt)("inlineCode",{parentName:"p"},"0.5"),"."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"costs.provider = 'gcp' AND costs.allocation = 0.5\n")),(0,n.kt)("h3",{id:"region"},"Costs from a List of Regions"),(0,n.kt)("p",null,"Filter for Snowflake costs in two regions. Note that you will need to use the region code, such as ",(0,n.kt)("inlineCode",{parentName:"p"},"us-east-1")," in the case of AWS, or ",(0,n.kt)("inlineCode",{parentName:"p"},"AWS_US_EAST_1")," in the case of Snowflake, below."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"costs.provider = 'snowflake' AND costs.region IN ('AWS_US_EAST_1', 'AWS_US_EAST_2')\n")),(0,n.kt)("h3",{id:"marketplace"},"Get Marketplace Transactions"),(0,n.kt)("p",null,"Retrieve costs associated with the AWS Marketplace."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"costs.provider = 'aws' AND costs.marketplace = true\n")),(0,n.kt)("h3",{id:"account"},"Costs by Account ID"),(0,n.kt)("p",null,"Costs for a specific set of services and account ID."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"costs.provider = 'aws' AND costs.account_id = '123456758' AND costs.service IN ('Amazon Relational Database', 'Amazon Elastic Compute Cloud - Compute')\n")),(0,n.kt)("h3",{id:"provider-account"},"Costs by Provider Account ID"),(0,n.kt)("p",null,"The following example represents costs from a specific AWS billing account or costs from a specific Azure subscription."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"(costs.provider = 'aws' AND costs.provider_account_id = 'abcd1234') OR (costs.provider = 'azure' AND costs.provider_account_id = 'abcd1234')\n")),(0,n.kt)("h3",{id:"resource"},"Per-Resource Costs and Costs by Service"),(0,n.kt)("p",null,"Resource costs require both ",(0,n.kt)("inlineCode",{parentName:"p"},"provider")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"service")," in addition to the ",(0,n.kt)("inlineCode",{parentName:"p"},"resource_id"),"."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"costs.provider = 'aws' AND costs.service = 'Amazon Relational Database Service' AND costs.resource_id = 'arn:aws:rds:us-east-1:123456789:db:primary-01'\n")),(0,n.kt)("h4",{id:"multiple-resource-ids"},"Multiple Resource IDs"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"costs.provider = 'aws' AND costs.service = 'Amazon Relational Database Service' AND costs.resource_id IN ('arn:aws:rds:us-east-1:123456789:db:primary-01', 'arn:aws:rds:us-east-1:123456789:db:primary-02')\n")),(0,n.kt)("h3",{id:"category"},"Costs by Specific Category"),(0,n.kt)("p",null,"Filter costs to see a specific cost category. Category costs require both ",(0,n.kt)("inlineCode",{parentName:"p"},"provider")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"service")," as well as ",(0,n.kt)("inlineCode",{parentName:"p"},"category"),"."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"costs.provider = 'fastly' AND costs.service = 'CDN' AND costs.category = 'Data Transfer'\n")),(0,n.kt)("h3",{id:"subcategory"},"Costs by Specific Subcategory"),(0,n.kt)("p",null,"Filter costs by a specific service and subcategory. Subcategory costs require both ",(0,n.kt)("inlineCode",{parentName:"p"},"provider")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"service")," as well as ",(0,n.kt)("inlineCode",{parentName:"p"},"subcategory"),"."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"costs.provider = 'aws' AND costs.service = 'AWS Certificate Manager' AND costs.subcategory = 'USE1-PaidPrivateCA'\n")),(0,n.kt)("h3",{id:"tags"},"Filter by Tag"),(0,n.kt)("h4",{id:"filter-by-single-tag"},"Filter by Single Tag"),(0,n.kt)("p",null,"Filter costs based on a specific tag, such as ",(0,n.kt)("inlineCode",{parentName:"p"},"environment"),", with the value ",(0,n.kt)("inlineCode",{parentName:"p"},"production"),", in AWS."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"costs.provider = 'aws' AND tags.name = 'environment' AND tags.value = 'production'\n")),(0,n.kt)("h4",{id:"multiple-tags"},"Filter by Multiple Tags"),(0,n.kt)("p",null,"If you want to filter for resources that have more than one tag associated, you can use the syntax shown in the example below."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"costs.provider = 'aws' AND (tags.name, tags.value) IN (('environment', 'staging'), ('team', 'engineering'))\n")),(0,n.kt)("p",null,"This example filters for resources that are tagged with the ",(0,n.kt)("inlineCode",{parentName:"p"},"environment")," tag with a value of ",(0,n.kt)("inlineCode",{parentName:"p"},"staging")," as well as the ",(0,n.kt)("inlineCode",{parentName:"p"},"team")," tag with a value of ",(0,n.kt)("inlineCode",{parentName:"p"},"engineering"),". This filter is the same as creating the following manual filter in the console."),(0,n.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,n.kt)("img",{alt:"Filter by multiple tags in the console",width:"80%",src:"/img/multiple-tags-example.png"})),(0,n.kt)("h4",{id:"filter-for-matching-tags-using-like"},"Filter for Matching Tags Using ",(0,n.kt)("inlineCode",{parentName:"h4"},"LIKE")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"costs.provider = 'azure' AND tags.name = 'environment' AND tags.value LIKE '%prod%'\n")),(0,n.kt)("h3",{id:"untagged"},"Filter for Untagged Resources"),(0,n.kt)("p",null,"On providers that have a ",(0,n.kt)("strong",{parentName:"p"},"Not Tagged"),"/",(0,n.kt)("strong",{parentName:"p"},"Not Labeled")," filter option in the console, you can use the below VQL to see untagged resources. This example looks for untagged resources in a multi-cloud environment."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"(costs.provider = 'aws' AND tags.name = NULL) OR (costs.provider = 'azure' AND tags.name = NULL) OR (costs.provider = 'gcp' AND tags.name = NULL)\n")),(0,n.kt)("h2",{id:"troubleshooting"},"Troubleshooting"),(0,n.kt)("p",null,"If you are receiving an error when trying to complete a query, check the following troubleshooting tips below."),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"Each provider exposes certain names to the API. Those names are normalized within the schema. Check the ",(0,n.kt)("a",{parentName:"p",href:"/data_dictionary"},"Data Dictionary")," for normalized field names.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"Query parameter values should be wrapped in single quotes."),(0,n.kt)("details",null,(0,n.kt)("summary",null,"Click to view examples"),(0,n.kt)("admonition",{parentName:"li",title:"This works",type:"tip"},(0,n.kt)("pre",{parentName:"admonition"},(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"costs.provider='aws'\n"))),(0,n.kt)("admonition",{parentName:"li",title:"This does not work",type:"caution"},(0,n.kt)("pre",{parentName:"admonition"},(0,n.kt)("code",{parentName:"pre",className:"language-sql"},'costs.provider="aws"\n'))))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"Currently, there is a limitation where ",(0,n.kt)("inlineCode",{parentName:"p"},"AND")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"OR"),' are not supported together in a single "query group."'),(0,n.kt)("details",null,(0,n.kt)("summary",null,"Click to view examples"),(0,n.kt)("admonition",{parentName:"li",title:"This works",type:"tip"},(0,n.kt)("pre",{parentName:"admonition"},(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"(costs.provider = 'aws' AND tags.name = 'environment' AND tags.value = 'dev') OR (costs.provider = 'aws' AND tags.name = 'environment' AND tags.value = 'prod')\n"))),(0,n.kt)("admonition",{parentName:"li",title:"This does not work",type:"caution"},(0,n.kt)("pre",{parentName:"admonition"},(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"costs.provider = 'aws' AND ((tags.name = 'environment' AND tags.value = 'dev') OR (tags.name = 'environment' AND tags.value = 'prod'))\n"))))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"The ",(0,n.kt)("inlineCode",{parentName:"p"},"costs.provider")," field is required on every call."),(0,n.kt)("details",null,(0,n.kt)("summary",null,"Click to view examples"),(0,n.kt)("admonition",{parentName:"li",title:"This works",type:"tip"},(0,n.kt)("pre",{parentName:"admonition"},(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"costs.provider = 'fastly' AND costs.service = 'CDN'\n"))),(0,n.kt)("admonition",{parentName:"li",title:"This does not work",type:"caution"},(0,n.kt)("pre",{parentName:"admonition"},(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"costs.service = 'CDN'\n"))))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"Resource costs require both provider and service in addition to the resource ID."),(0,n.kt)("details",null,(0,n.kt)("summary",null,"Click to view examples"),(0,n.kt)("admonition",{parentName:"li",title:"This works",type:"tip"},(0,n.kt)("pre",{parentName:"admonition"},(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"costs.provider = 'aws' AND costs.service = 'Amazon Relational Database Service' AND costs.resource_id = 'arn:aws:rds:us-east-1:123456789:db:primary-01'\n"))),(0,n.kt)("admonition",{parentName:"li",title:"This does not work",type:"caution"},(0,n.kt)("pre",{parentName:"admonition"},(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"costs.provider = 'aws' AND costs.resource_id = 'arn:aws:rds:us-east-1:123456789:db:primary-01'\n"))))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"Category and subcategory costs also require provider and service."),(0,n.kt)("details",null,(0,n.kt)("summary",null,"Click to view examples"),(0,n.kt)("admonition",{parentName:"li",title:"These work",type:"tip"},(0,n.kt)("pre",{parentName:"admonition"},(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"costs.provider = 'fastly' AND costs.service = 'CDN' AND costs.category = 'Data Transfer'\n")),(0,n.kt)("pre",{parentName:"admonition"},(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"costs.provider = 'aws' AND costs.service = 'AWS Certificate Manager' AND costs.subcategory = 'USE1-PaidPrivateCA'\n"))),(0,n.kt)("admonition",{parentName:"li",title:"These do not work",type:"caution"},(0,n.kt)("pre",{parentName:"admonition"},(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"costs.provider = 'fastly' AND costs.category = 'Data Transfer'\n")),(0,n.kt)("pre",{parentName:"admonition"},(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"costs.provider = 'aws' AND costs.subcategory = 'USE1-PaidPrivateCA'\n")))))))}k.isMDXComponent=!0}}]);