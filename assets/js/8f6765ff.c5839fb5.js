"use strict";(self.webpackChunkdocs_vantage_sh=self.webpackChunkdocs_vantage_sh||[]).push([[9962],{5162:(e,t,a)=>{a.d(t,{Z:()=>l});var i=a(7294),n=a(6010);const s={tabItem:"tabItem_Ymn6"};function l(e){let{children:t,hidden:a,className:l}=e;return i.createElement("div",{role:"tabpanel",className:(0,n.Z)(s.tabItem,l),hidden:a},t)}},4866:(e,t,a)=>{a.d(t,{Z:()=>w});var i=a(7462),n=a(7294),s=a(6010),l=a(2466),r=a(6550),o=a(1980),u=a(7392),g=a(12);function d(e){return function(e){return n.Children.map(e,(e=>{if((0,n.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))}(e).map((e=>{let{props:{value:t,label:a,attributes:i,default:n}}=e;return{value:t,label:a,attributes:i,default:n}}))}function p(e){const{values:t,children:a}=e;return(0,n.useMemo)((()=>{const e=t??d(a);return function(e){const t=(0,u.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,a])}function c(e){let{value:t,tabValues:a}=e;return a.some((e=>e.value===t))}function h(e){let{queryString:t=!1,groupId:a}=e;const i=(0,r.k6)(),s=function(e){let{queryString:t=!1,groupId:a}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!a)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return a??null}({queryString:t,groupId:a});return[(0,o._X)(s),(0,n.useCallback)((e=>{if(!s)return;const t=new URLSearchParams(i.location.search);t.set(s,e),i.replace({...i.location,search:t.toString()})}),[s,i])]}function m(e){const{defaultValue:t,queryString:a=!1,groupId:i}=e,s=p(e),[l,r]=(0,n.useState)((()=>function(e){let{defaultValue:t,tabValues:a}=e;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!c({value:t,tabValues:a}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${a.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const i=a.find((e=>e.default))??a[0];if(!i)throw new Error("Unexpected error: 0 tabValues");return i.value}({defaultValue:t,tabValues:s}))),[o,u]=h({queryString:a,groupId:i}),[d,m]=function(e){let{groupId:t}=e;const a=function(e){return e?`docusaurus.tab.${e}`:null}(t),[i,s]=(0,g.Nk)(a);return[i,(0,n.useCallback)((e=>{a&&s.set(e)}),[a,s])]}({groupId:i}),f=(()=>{const e=o??d;return c({value:e,tabValues:s})?e:null})();(0,n.useLayoutEffect)((()=>{f&&r(f)}),[f]);return{selectedValue:l,selectValue:(0,n.useCallback)((e=>{if(!c({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);r(e),u(e),m(e)}),[u,m,s]),tabValues:s}}var f=a(2389);const k={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function v(e){let{className:t,block:a,selectedValue:r,selectValue:o,tabValues:u}=e;const g=[],{blockElementScrollPositionUntilNextRender:d}=(0,l.o5)(),p=e=>{const t=e.currentTarget,a=g.indexOf(t),i=u[a].value;i!==r&&(d(t),o(i))},c=e=>{let t=null;switch(e.key){case"Enter":p(e);break;case"ArrowRight":{const a=g.indexOf(e.currentTarget)+1;t=g[a]??g[0];break}case"ArrowLeft":{const a=g.indexOf(e.currentTarget)-1;t=g[a]??g[g.length-1];break}}t?.focus()};return n.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.Z)("tabs",{"tabs--block":a},t)},u.map((e=>{let{value:t,label:a,attributes:l}=e;return n.createElement("li",(0,i.Z)({role:"tab",tabIndex:r===t?0:-1,"aria-selected":r===t,key:t,ref:e=>g.push(e),onKeyDown:c,onClick:p},l,{className:(0,s.Z)("tabs__item",k.tabItem,l?.className,{"tabs__item--active":r===t})}),a??t)})))}function y(e){let{lazy:t,children:a,selectedValue:i}=e;if(a=Array.isArray(a)?a:[a],t){const e=a.find((e=>e.props.value===i));return e?(0,n.cloneElement)(e,{className:"margin-top--md"}):null}return n.createElement("div",{className:"margin-top--md"},a.map(((e,t)=>(0,n.cloneElement)(e,{key:t,hidden:e.props.value!==i}))))}function b(e){const t=m(e);return n.createElement("div",{className:(0,s.Z)("tabs-container",k.tabList)},n.createElement(v,(0,i.Z)({},e,t)),n.createElement(y,(0,i.Z)({},e,t)))}function w(e){const t=(0,f.Z)();return n.createElement(b,(0,i.Z)({key:String(t)},e))}},9961:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>g,default:()=>f,frontMatter:()=>u,metadata:()=>d,toc:()=>c});var i=a(7462),n=(a(7294),a(3905)),s=a(2004),l=a.n(s),r=a(4866),o=a(5162);const u={id:"tagging",name:"Tagging",description:"Create virtual tags within Vantage to provide a consistent tagging schema across cloud providers.",keywords:["Virtual tagging","Vantage tags"],toc_max_heading_level:4},g="Tagging",d={unversionedId:"tagging",id:"tagging",title:"Tagging",description:"Create virtual tags within Vantage to provide a consistent tagging schema across cloud providers.",source:"@site/docs/tagging.md",sourceDirName:".",slug:"/tagging",permalink:"/tagging",draft:!1,editUrl:"https://github.com/vantage-sh/docs.vantage.sh/blob/master/docs/tagging.md",tags:[],version:"current",frontMatter:{id:"tagging",name:"Tagging",description:"Create virtual tags within Vantage to provide a consistent tagging schema across cloud providers.",keywords:["Virtual tagging","Vantage tags"],toc_max_heading_level:4},sidebar:"someSidebar",previous:{title:"Workspaces",permalink:"/workspaces"},next:{title:"Vantage for MSPs",permalink:"/partners"}},p={},c=[{value:"Tag Management: Provider and Virtual Tags",id:"tag-management-provider-and-virtual-tags",level:2},{value:"View Tags on a Cost Report",id:"view-tags-on-a-cost-report",level:3},{value:"Hide Tags",id:"hide-tags",level:3},{value:"Hide Tags Example: Standardizing Redundant Tag Keys",id:"hide-tags-example-standardizing-redundant-tag-keys",level:4},{value:"Virtual Tags",id:"virtual-tags",level:2},{value:"Virtual Tags vs. Saved Filters vs. Cost Allocation Segments",id:"virtual-tags-vs-saved-filters-vs-cost-allocation-segments",level:3},{value:"Custom Value Tags",id:"custom-value-tags",level:3},{value:"Cost-Based and Business Metrics-Based Allocation Tags",id:"cost-based-and-business-metrics-based-allocation-tags",level:3},{value:"Cost-Based Allocation Tags",id:"cost-based-allocation-tags",level:4},{value:"Business Metrics-Based Allocation Tags",id:"business-metrics-based-allocation-tags",level:4},{value:"Virtual Tags Limits",id:"virtual-tag-limit",level:3},{value:"Create Virtual Tags",id:"create-virtual-tags",level:3},{value:"Nested Virtual Tags",id:"nested-virtual-tags",level:4},{value:"Virtual Tag Order",id:"virtual-tag-order",level:4},{value:"Filter and Group by Virtual Tags",id:"filter-and-group-by-virtual-tags",level:3},{value:"Delete a Virtual Tag",id:"delete-a-virtual-tag",level:3},{value:"Virtual Tagging Examples",id:"examples",level:3},{value:"Custom Value Examples",id:"custom-values-example",level:4},{value:"Example 1: Cross-Provider Tagging",id:"example-1-cross-provider-tagging",level:5},{value:"Step 1: Create a New Tag",id:"step-1-create-a-new-tag",level:6},{value:"Step 2: Add Tag Values and Filters",id:"step-2-add-tag-values-and-filters",level:6},{value:"Example 2: Consolidate Existing Tags",id:"example-2-consolidate-existing-tags",level:5},{value:"Step 1: Create a New Tag",id:"step-1-create-a-new-tag-1",level:6},{value:"Step 2: Add Tag Values and Filters",id:"step-2-add-tag-values-and-filters-1",level:6},{value:"Example 3: Using Flexible Match to Consolidate similar Tag Values",id:"example-3-using-flexible-match-to-consolidate-similar-tag-values",level:5},{value:"Step 1: Create a New Tag",id:"step-1-create-a-new-tag-2",level:6},{value:"Step 2: Add Tag Values and Filters",id:"step-2-add-tag-values-and-filters-2",level:6},{value:"Cost-Based Allocation Example",id:"cost-based-allocation-example",level:4},{value:"Prerequisites",id:"prerequisites",level:5},{value:"Step 1: Create a New Cost-Based Allocation Tag",id:"step-1-create-a-new-cost-based-allocation-tag",level:5},{value:"Step 2: Select an Input Cost Filter",id:"step-2-select-an-input-cost-filter",level:5},{value:"Step 3: Select a Tag Key",id:"step-3-select-a-tag-key",level:5},{value:"Step 4: Select an Output Cost Filter",id:"step-4-select-an-output-cost-filter",level:5},{value:"Business Metrics-Based Allocation Example",id:"metric-based-allocation-example",level:4},{value:"Prerequisite",id:"prerequisite",level:5},{value:"Step 1: Create a New Business Metrics-Based Allocation Tag",id:"step-1-create-a-new-business-metrics-based-allocation-tag",level:5},{value:"Step 2: Select the Labeled Business Metric",id:"step-2-select-the-labeled-business-metric",level:5},{value:"Step 3: Select an Output Cost Filter",id:"step-3-select-an-output-cost-filter",level:5},{value:"Nested Virtual Tags Example",id:"nested-virtual-tags-example",level:4},{value:"Step 1: Create an Application Virtual Tag with Values for Each App",id:"step-1-create-an-application-virtual-tag-with-values-for-each-app",level:5},{value:"Step 2: Create a Virtual Tag for Business Unit Costs",id:"step-2-create-a-virtual-tag-for-business-unit-costs",level:5},{value:"Step 3: Review the Nested Virtual Tag in Reports",id:"step-3-review-the-nested-virtual-tag-in-reports",level:5},{value:"Tagging Untaggable Resources in AWS Example",id:"untaggable-aws",level:4}],h={toc:c},m="wrapper";function f(e){let{components:t,...a}=e;return(0,n.kt)(m,(0,i.Z)({},h,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"tagging"},"Tagging"),(0,n.kt)("p",null,"With tagging visibility in Vantage, you can view your ",(0,n.kt)("em",{parentName:"p"},"provider tags")," and create and manage ",(0,n.kt)("em",{parentName:"p"},"virtual tags"),"."),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"Provider tags:")," Tags that are directly associated with and managed within your cloud service providers, such as AWS, Azure, or GCP. These tags are typically applied to resources in your cloud environment to organize and categorize costs. Vantage retrieves and displays these tags in reports, which allows you to analyze costs based on existing tagging strategies."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"Virtual tags:")," This feature can help to increase tagging coverage across your cloud infrastructure. Create cost allocation tag keys with a set of corresponding values and filters directly in the Vantage without needing to involve your engineering team in making infrastructure changes. All provider integrations in Vantage are supported, including providers that don't natively support tags. Virtual tags are available for filtering and aggregating on all ",(0,n.kt)("a",{parentName:"li",href:"/cost_reports"},"Cost Reports")," and ",(0,n.kt)("a",{parentName:"li",href:"/segments"},"cost allocation segments"),". They can also be used in filter criteria on ",(0,n.kt)("a",{parentName:"li",href:"/saved_filters"},"saved filters"),". ")),(0,n.kt)("h2",{id:"tag-management-provider-and-virtual-tags"},"Tag Management: Provider and Virtual Tags"),(0,n.kt)("p",null,"On the ",(0,n.kt)("strong",{parentName:"p"},"Tags")," page, you can view all tags, including both provider and virtual tags. From the top navigation, click ",(0,n.kt)("strong",{parentName:"p"},"Settings"),". On the left navigation, under ",(0,n.kt)("strong",{parentName:"p"},"General Settings"),", click ",(0,n.kt)("strong",{parentName:"p"},"Tags"),"."),(0,n.kt)("p",null,"Two tabs are displayed: ",(0,n.kt)("strong",{parentName:"p"},"All Tags")," and ",(0,n.kt)("strong",{parentName:"p"},"Virtual Tags"),". "),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"On the ",(0,n.kt)("strong",{parentName:"li"},"All Tags")," tab, you can view both your provider (denoted by a grey tag icon) and virtual tags (denoted by a purple tag icon). Tags are listed along with any associated providers. You can also hide or unhide a tag and view a corresponding Cost Report filtered to that tag (see sections below). ",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"If you select a provider tag in this view, a new screen to create a virtual tag with the same name is displayed. You may want to do this in cases where you want Vantage to combine filter criteria from different providers but use the same tag name."),(0,n.kt)("li",{parentName:"ul"},"If you select a virtual tag in this view, the virtual tag page is displayed, where you can edit any existing tag criteria. "))),(0,n.kt)("li",{parentName:"ul"},"On the ",(0,n.kt)("strong",{parentName:"li"},"Virtual Tags")," tab, you can view a list of all created virtual tags. A link to the virtual tag is provided. The ",(0,n.kt)("strong",{parentName:"li"},"Tag Values")," column indicates how many values are currently associated with the virtual tag. Any associated providers are listed, as well as when the tag was created and who created the tag in Vantage. ")),(0,n.kt)("p",null,"At the top of the main Tags screen, you can search for specific tags and filter for tags by provider (e.g., AWS)."),(0,n.kt)("h3",{id:"view-tags-on-a-cost-report"},"View Tags on a Cost Report"),(0,n.kt)("p",null,"From the ",(0,n.kt)("strong",{parentName:"p"},"Tags")," page, you can view a Cost Report that is filtered and grouped based on a selected tag. You can do this for both provider and virtual tags. This can help you to view any current or past costs associated with the tag. In the below visual example:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"The user searches for the ",(0,n.kt)("inlineCode",{parentName:"li"},"environment")," virtual tag and selects to view a Cost Report for that tag."),(0,n.kt)("li",{parentName:"ul"},"The Cost Report is displayed. The report is also filtered by the tag's associated providers by the tag and grouped by that tag's values. ")),(0,n.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,n.kt)("div",{style:{boxShadow:"0 0 10px rgba(0, 0, 0, 0.2)",borderRadius:"10px",width:"100%",overflow:"hidden"}},(0,n.kt)(l(),{playing:!0,muted:!0,playsinline:!0,loop:!0,url:"/img/cost-report-tag.mp4",alt:"Viewing a Cost Report for a specific tag.",width:"100%",height:"100%",mdxType:"ReactPlayer"}))),(0,n.kt)("h3",{id:"hide-tags"},"Hide Tags"),(0,n.kt)("p",null,"From the ",(0,n.kt)("strong",{parentName:"p"},"Tags")," page, you can hide tag keys that you don't want to appear in report filters or grouping options. This is useful for removing redundant tags or preventing other users from seeing certain tags in reports. "),(0,n.kt)("p",null,"To hide a tag key, click the eyeball icon next to the tag on the ",(0,n.kt)("strong",{parentName:"p"},"All Tags")," tab. As soon as a tag key is hidden, the following changes occur in Vantage:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"Hidden from report menus:")," The tag key is no longer displayed in the ",(0,n.kt)("strong",{parentName:"li"},"Filters")," or ",(0,n.kt)("strong",{parentName:"li"},"Group By")," menus on reports for other Vantage users; however, users with the Owner role can still manage tag visibility (i.e., unhide the tag) via the ",(0,n.kt)("strong",{parentName:"li"},"Tags")," screen."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"Existing reports remain functional:")," If a report was already filtered or grouped by the hidden tag, it will continue to work, but if you edit the report\u2019s filters, the hidden tag will no longer be available in the filter\u2019s selection list."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"Usable in virtual tags:")," Hidden tags can still be used when creating virtual tags and will appear in virtual tag filters. If a hidden tag is included in a virtual tag\u2019s filter criteria, a message is displayed next to it, indicating that it is hidden and only usable for virtual tag creation."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"Still accessible via API:")," Hidden tags remain available through ",(0,n.kt)("a",{parentName:"li",href:"https://vantage.readme.io/reference/gettags"},"API requests"),".")),(0,n.kt)("h4",{id:"hide-tags-example-standardizing-redundant-tag-keys"},"Hide Tags Example: Standardizing Redundant Tag Keys"),(0,n.kt)("p",null,"You are working to clean up your tagging and notice that teams have applied multiple variations of the same environment-related tag key across different AWS resources:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"env")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"environment")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"Environment"))),(0,n.kt)("p",null,"Because all three tags represent the same concept, having them appear separately in report filters and grouping options creates inconsistencies and makes cost analysis more difficult. You are unable to see the full view of how costs are attributed to each environment."),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"You complete the following steps to hide the redundant tags:")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"You navigate to the ",(0,n.kt)("strong",{parentName:"li"},"Tags")," page in Vantage to search for and identify the different versions of the environment tag. You then hide each iteration of this tag so that you can create a new standardized version of the tag with Vantage virtual tags.",(0,n.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,n.kt)("img",{alt:"New virtual tag that shows all iterations of environment",width:"100%",src:"/img/tags-settings-env.png"}))),(0,n.kt)("li",{parentName:"ul"},"All three hidden tags no longer appear in the Filters and Group By menus for other users.",(0,n.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,n.kt)("img",{alt:"Attempting to filter for a hidden tag",width:"80%",src:"/img/tags-filter-env.png"}))),(0,n.kt)("li",{parentName:"ul"},"Existing reports that were already filtered or grouped by these tags remain functional; however, if a user edits the report\u2019s filters, they will no longer see those hidden tag variations.")),(0,n.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,n.kt)("div",{style:{boxShadow:"0 0 10px rgba(0, 0, 0, 0.2)",borderRadius:"10px",width:"100%",overflow:"hidden"}},(0,n.kt)(l(),{playing:!0,muted:!0,playsinline:!0,loop:!0,url:"/img/hidden-tag-report.mp4",alt:"Viewing the hidden environment tag",width:"100%",height:"100%",mdxType:"ReactPlayer"}))),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"The hidden tags are still available via API requests, so any external automation using them still continues to work.")),(0,n.kt)("p",null,"You then complete the following steps to create a virtual tag that combines the values from all the previous tag iterations:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"You create a new virtual tag named ",(0,n.kt)("inlineCode",{parentName:"li"},"environment")," that consolidates all three variations from the AWS provider tag."),(0,n.kt)("li",{parentName:"ul"},"For each tag value (e.g., ",(0,n.kt)("inlineCode",{parentName:"li"},"production")," or ",(0,n.kt)("inlineCode",{parentName:"li"},"development"),"), you create a filter that combines the ",(0,n.kt)("inlineCode",{parentName:"li"},"production")," values from the previous tags. You can then use this new virtual tag within reports.")),(0,n.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,n.kt)("img",{alt:"New virtual tag that shows all iterations of environment",width:"80%",src:"/img/env-virtual-tag.png"})),(0,n.kt)("p",null,"As a result, your users now see only the ",(0,n.kt)("inlineCode",{parentName:"p"},"environment")," virtual tag in their report filters, reducing confusion and keeping reports standardized. This approach helps enforce tagging consistency without you having to further educate your users on which versions of a tag key to use in reports."),(0,n.kt)("h2",{id:"virtual-tags"},"Virtual Tags"),(0,n.kt)("admonition",{type:"tip"},(0,n.kt)("p",{parentName:"admonition"},"To get started with virtual tagging, you can also view a video demo on ",(0,n.kt)("a",{parentName:"p",href:"/vantage_university_cost_allocation"},"Vantage University")," \ud83c\udf93.")),(0,n.kt)("h3",{id:"virtual-tags-vs-saved-filters-vs-cost-allocation-segments"},"Virtual Tags vs. Saved Filters vs. Cost Allocation Segments"),(0,n.kt)("p",null,"Virtual tags can be considered foundational to the rest of the data within Vantage. They should remain fairly static, and changes should be considered delicate. These changes will flow across all data and apply to all workspaces. The most common tag keys will be items like team, cost center, and environment."),(0,n.kt)("p",null,"Segments can then be used to create different hierarchical views for tagged data. This feature is useful for breaking down the data by different perspectives, such as by cost center or by OPEX/CapEX."),(0,n.kt)("p",null,"Saved filters can then be used in a more ad-hoc fashion to add lenses on top of base data. For instance, you could create a saved filter just for ",(0,n.kt)("em",{parentName:"p"},"North America")," that standardizes a set of regions across providers and can be used by teams on their reports or dashboards without having to know the set of filters needed to create the list of regions. When new regions come online, it\u2019s easy to modify the saved filter to include this region."),(0,n.kt)("admonition",{type:"note"},(0,n.kt)("p",{parentName:"admonition"},"If you want to transition any of your cost allocation segments to virtual tags, contact ",(0,n.kt)("a",{parentName:"p",href:"mailto:support@vantage.sh"},"support@vantage.sh"),".")),(0,n.kt)("h3",{id:"custom-value-tags"},"Custom Value Tags"),(0,n.kt)("p",null,"With custom value tags, you can create new cross-provider cost allocation tags to help better your tagging strategy. For example, you may have a series of resource tags, by product, across each of your providers. You can create custom tags in Vantage to combine those costs into one unique product tag for all resources in that product group."),(0,n.kt)("p",null,"See the ",(0,n.kt)("a",{parentName:"p",href:"/tagging#custom-values-example"},"example section")," below for details."),(0,n.kt)("h3",{id:"cost-based-and-business-metrics-based-allocation-tags"},"Cost-Based and Business Metrics-Based Allocation Tags"),(0,n.kt)("p",null,"The cost-based and business metrics-based allocation tag types allow for ",(0,n.kt)("em",{parentName:"p"},"dynamic cost allocation"),", which is the process of allocating costs based on another existing cost or metric. See the below video for an introduction to dynamic cost allocation."),(0,n.kt)("div",{style:{position:"relative",width:"100%",paddingBottom:"56.25%",height:"0",overflow:"hidden"}},(0,n.kt)("iframe",{src:"https://www.youtube.com/embed/67RbHPtfgEE?si=3J14Pjwos6ubUdSd?rel=0&color=white&modestbranding=1&wmode=transparent",allowFullScreen:!0,style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",borderRadius:"10px"}})),(0,n.kt)("h4",{id:"cost-based-allocation-tags"},"Cost-Based Allocation Tags"),(0,n.kt)("p",null,"With cost-based allocation tags, you can create a dynamically allocated cost structure. Select a set of input costs (e.g., all AWS costs), an existing cost tag to use for allocation (e.g., a teams cost tag), and an output cost (e.g, a static cost, like AWS Support) that you want to be allocated the same way as your input cost."),(0,n.kt)("p",null,"See the ",(0,n.kt)("a",{parentName:"p",href:"/tagging#cost-based-allocation-example"},"example section")," below for details."),(0,n.kt)("h4",{id:"business-metrics-based-allocation-tags"},"Business Metrics-Based Allocation Tags"),(0,n.kt)("p",null,"With business metrics-based allocation tags, you select an existing ",(0,n.kt)("a",{parentName:"p",href:"/per_unit_costs"},"business metric")," (e.g., CPU use per product) and indicate your output cost (e.g., all GCP Compute costs) so that the allocation of the output cost mimics the percentage allocation of the existing business metric."),(0,n.kt)("p",null,"See the ",(0,n.kt)("a",{parentName:"p",href:"/tagging#metric-based-allocation-example"},"example section")," below for details."),(0,n.kt)("h3",{id:"virtual-tag-limit"},"Virtual Tags Limits"),(0,n.kt)("p",null,"You can create up to 50 virtual tag configurations, with each tag supporting up to 100 configuration values."),(0,n.kt)("h3",{id:"create-virtual-tags"},"Create Virtual Tags"),(0,n.kt)("admonition",{type:"note"},(0,n.kt)("p",{parentName:"admonition"},"This feature requires ",(0,n.kt)("em",{parentName:"p"},"Owner")," permissions in Vantage. See the ",(0,n.kt)("a",{parentName:"p",href:"/rbac"},"Role-Based Access Control")," documentation for details. Virtual tags apply to all ",(0,n.kt)("a",{parentName:"p",href:"/workspaces"},"workspaces"),".")),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"From the top navigation, click ",(0,n.kt)("strong",{parentName:"p"},"Settings"),".")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"From the side navigation, under ",(0,n.kt)("strong",{parentName:"p"},"General Settings"),", click ",(0,n.kt)("strong",{parentName:"p"},"Tags"),".")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"On the ",(0,n.kt)("strong",{parentName:"p"},"All Tags")," tab all your tags\u2014both provider and virtual\u2014are displayed. Click the ",(0,n.kt)("strong",{parentName:"p"},"Virtual Tags")," tab. All existing virtual tags are displayed. You can edit any existing tags from this tab. To add a new virtual tag, click ",(0,n.kt)("strong",{parentName:"p"},"Create a Virtual Tag"),".")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Enter a title for the ",(0,n.kt)("strong",{parentName:"p"},"Tag Key"),".")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"For ",(0,n.kt)("strong",{parentName:"p"},"Billing Period Backfill"),", select a billing period (e.g., ",(0,n.kt)("strong",{parentName:"p"},"Apr 2024"),") for which the tag should be backfilled.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Enable the ",(0,n.kt)("strong",{parentName:"p"},"Can Override")," toggle if you want the virtual tag to override an existing service cost value. For example, if you create a virtual tag that conflicts with an existing provider tag, this option will override the existing provider tag key in Vantage reports.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"In the ",(0,n.kt)("strong",{parentName:"p"},"Values")," section, click ",(0,n.kt)("strong",{parentName:"p"},"+Add"),". Select whether you want to create a ",(0,n.kt)("strong",{parentName:"p"},"Custom Value"),", ",(0,n.kt)("strong",{parentName:"p"},"Business Metric"),", or ",(0,n.kt)("strong",{parentName:"p"},"Cost Based")," value. Click through the tabs below for instructions on each value type."),(0,n.kt)("admonition",{parentName:"li",type:"note"},(0,n.kt)("p",{parentName:"admonition"},"You cannot use an existing virtual tag within the filters\xa0for virtual tags with forms of cost allocation (i.e., Business Metric or Cost Based virtual tags). You can, however, select an existing\xa0provider tag\xa0(e.g., one that comes from AWS). If you attempt to select an allocated virtual tag as part of your filter criteria, the following message is displayed.")," ",(0,n.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,n.kt)("img",{alt:"A message in a virtual tag filter indicating you cannot use allocated virtual tags for filter criteria in another tag",width:"80%",src:"/img/tags-dynamic-tot.png"})),(0,n.kt)("p",{parentName:"admonition"}," You can use existing virtual tags in the ",(0,n.kt)("strong",{parentName:"p"},"Output Costs Filter")," for Custom Value virtual tags. See the ",(0,n.kt)("a",{parentName:"p",href:"/tagging#nested-virtual-tags"},"Nested Virtual Tags")," section for details.")),(0,n.kt)(r.Z,{mdxType:"Tabs"},(0,n.kt)(o.Z,{value:"custom",label:"Add Custom Value",default:!0,mdxType:"TabItem"},(0,n.kt)("ol",null,(0,n.kt)("li",null,"Click ",(0,n.kt)("strong",null,"Assign Custom Value"),"."),(0,n.kt)("li",null,"Enter a ",(0,n.kt)("strong",null,"Tag Value")," title. Titles can contain only letters, numbers, and the following characters: ",(0,n.kt)("code",null,"\\_ - & + , . : / \\ @"),". You cannot use saved filters to define a virtual tag value's filters."),(0,n.kt)("li",null,"Specify the tag value's filter criteria (i.e., ",(0,n.kt)("b",null,"Output Cost Filters"),"). These filters function just like filters on Cost Reports and cost allocation segments. For information on how to create detailed filters, see the\xa0",(0,n.kt)("a",{href:"/cost_reports"},"Cost Reports"),"\xa0documentation."))),(0,n.kt)(o.Z,{value:"business",label:"Add Business Metric Value",default:!0,mdxType:"TabItem"},(0,n.kt)("ol",null,(0,n.kt)("li",null,"Click ",(0,n.kt)("strong",null,"Connect a Business Metric"),"."),(0,n.kt)("li",null,"Select an existing ",(0,n.kt)("a",{href:"/per_unit_costs"},"business metric"),"."),(0,n.kt)("li",null,"Select the ",(0,n.kt)("strong",null,"Output Costs Filter")," that will be split among your tag values based on your business metric. These filters function just like filters on Cost Reports and cost allocation segments. For information on how to create detailed filters, see the\xa0",(0,n.kt)("a",{href:"/cost_reports"},"Cost Reports"),"\xa0documentation."))),(0,n.kt)(o.Z,{value:"cost",label:"Add Cost Based Value",default:!0,mdxType:"TabItem"},(0,n.kt)("ol",null,(0,n.kt)("li",null,"Select ",(0,n.kt)("strong",null,"Cost Based"),"."),(0,n.kt)("li",null,"Select an ",(0,n.kt)("strong",null,"Input Costs Filter")," to specify which category of input costs to include in the allocation. These filters function just like filters on Cost Reports and cost allocation segments. For information on how to create detailed filters, see the\xa0",(0,n.kt)("a",{href:"/cost_reports"},"Cost Reports"),"\xa0documentation. ",(0,n.kt)("br",null),(0,n.kt)("blockquote",null,(0,n.kt)("i",null,(0,n.kt)("b",null,"Tip:")," For most use cases, you should set a filter for ",(0,n.kt)("b",null,"Charge Type = Usage")," on the input filter to ensure you are matching on only usage-related costs and ignoring costs related to items like credits, taxes, fees, etc."))),(0,n.kt)("li",null,"Select an existing cost ",(0,n.kt)("strong",null,"Tag Key"),". This value can be an existing tag you have in one of your cost providers, like AWS."),(0,n.kt)("li",null,"Select the ",(0,n.kt)("strong",null,"Output Costs Filter")," to indicate the costs that will be split among your tag values based on your input cost filter.")))),(0,n.kt)("hr",{parentName:"li"})),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"At the top, click ",(0,n.kt)("strong",{parentName:"p"},"Save"),"."))),(0,n.kt)("p",null,"Processing tag changes usually takes under an hour. At the top of the ",(0,n.kt)("strong",{parentName:"p"},"Virtual Tags")," screen, the processing status is displayed. Processing times vary based on the number of tags and volume of data you have imported into Vantage."),(0,n.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,n.kt)("img",{alt:"The virtual tag screen with a processing status displayed for Fastly and New Relic",width:"80%",src:"/img/virtual-tag-status.png"})),(0,n.kt)("h4",{id:"nested-virtual-tags"},"Nested Virtual Tags"),(0,n.kt)("p",null,"With nested virtual tags, you can use virtual tags as part of the filter criteria for other virtual tag values. Nested virtual tags apply only to ",(0,n.kt)("a",{parentName:"p",href:"/tagging#custom-value-tags"},"Custom Value Virtual Tags"),". These tags let you align cloud provider data with internal taxonomies for effective grouping and querying."),(0,n.kt)("p",null,"To reference an existing virtual tag in another virtual tag:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Create a new Custom Value. "),(0,n.kt)("li",{parentName:"ol"},"Enter a name. "),(0,n.kt)("li",{parentName:"ol"},"For the ",(0,n.kt)("strong",{parentName:"li"},"Output Cost Filter"),": ",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Select a provider."),(0,n.kt)("li",{parentName:"ul"},"Select ",(0,n.kt)("strong",{parentName:"li"},"Tag"),", then select an existing virtual tag key. Look for the purple tag icon with the Vantage logo to identify existing virtual tags.")))),(0,n.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,n.kt)("img",{alt:"The virtual tag screen selecting an existing virtual tag in the filter for a new tag value",width:"80%",src:"/img/tags-filter-tot.png"})),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Nested Virtual Tag Considerations")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Do not create a nested virtual tag that references itself (i.e., a cyclical reference); this will result in an error."),(0,n.kt)("li",{parentName:"ul"},"If you update the filters of a virtual tag that is referenced by another virtual tag, costs are reprocessed based on the updated hierarchy."),(0,n.kt)("li",{parentName:"ul"},"If you delete or rename a virtual tag that is referenced by another virtual tag, you will see a warning. If you proceed, Vantage reprocesses costs with the new configuration.")),(0,n.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,n.kt)("img",{alt:"Modal that's displayed indicating if you delete a nested virtual tag that it will affect other connected tags",width:"60%",src:"/img/tags-delete-tot.png"})),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"You can create up to 49 nested virtual tags, since an organization is ",(0,n.kt)("a",{parentName:"li",href:"/tagging#virtual-tag-limit"},"limited to")," 50 distinct virtual tag keys. Because nested virtual tags are processed sequentially, increasing the number of nested values will slow down the tagging process.")),(0,n.kt)("p",null,"See the ",(0,n.kt)("a",{parentName:"p",href:"/tagging#nested-virtual-tags-example"},"Nested Virtual Tags Example")," section below for a sample tag hierarchy."),(0,n.kt)("h4",{id:"virtual-tag-order"},"Virtual Tag Order"),(0,n.kt)("p",null,"Tag values are arranged in priority order on the ",(0,n.kt)("strong",{parentName:"p"},"Virtual Tags")," screen. You can move tag values up and down in the UI to reorder them, as demonstrated in the visual example below."),(0,n.kt)("div",{style:{display:"flex",justifyContent:"center",boxShadow:"0 0 10px rgba(0, 0, 0, 0.2)",borderRadius:"10px",overflow:"hidden"}},(0,n.kt)("img",{alt:"GIF of two tag values, staging and production, being reordered in the Tags UI",width:"80%",src:"/img/reorder-tags.gif"})),(0,n.kt)("br",null),(0,n.kt)("p",null,"When cost data is ingested into Vantage, the first value that matches the corresponding filters will be applied to that line item. In cases where filters overlap, the order of tag values within each key determines the value that is applied."),(0,n.kt)("h3",{id:"filter-and-group-by-virtual-tags"},"Filter and Group by Virtual Tags"),(0,n.kt)("p",null,"You can filter by virtual tags in Cost Reports, cost allocation segments, and when creating saved filters. Virtual tags are visible along with your existing provider tags. Use the ",(0,n.kt)("strong",{parentName:"p"},"Tag")," (",(0,n.kt)("strong",{parentName:"p"},"Label")," in GCP) filter and grouping option."),(0,n.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,n.kt)("img",{alt:"A Cost Report filter with two filters applied: one for AWS costs for the team/data tag and one for GCP costs with the same tag",width:"80%",src:"/img/virtual-tag-consolidate-report.png"})),(0,n.kt)("h3",{id:"delete-a-virtual-tag"},"Delete a Virtual Tag"),(0,n.kt)("p",null,"To delete a virtual tag, navigate to the ",(0,n.kt)("a",{parentName:"p",href:"https://console.vantage.sh/settings/tags"},"Tags")," page. Select the ",(0,n.kt)("strong",{parentName:"p"},"Virtual Tags")," tab and open an existing virtual tag. Click the trashcan icon at the top of the tag page. Your data will be re-tagged, excluding the deleted virtual tag, going back to the deleted tag\u2019s backfill bill period. Newly ingested data will no longer be tagged with the deleted tag."),(0,n.kt)("h3",{id:"examples"},"Virtual Tagging Examples"),(0,n.kt)("p",null,"The following examples demonstrate how to use virtual tagging in a multi-provider organization."),(0,n.kt)("h4",{id:"custom-values-example"},"Custom Value Examples"),(0,n.kt)("h5",{id:"example-1-cross-provider-tagging"},"Example 1: Cross-Provider Tagging"),(0,n.kt)("p",null,"You want to create a tag mapping for each of your teams that maps corresponding teams with certain services and provider accounts."),(0,n.kt)("h6",{id:"step-1-create-a-new-tag"},"Step 1: Create a New Tag"),(0,n.kt)("p",null,"You create a tag key called ",(0,n.kt)("inlineCode",{parentName:"p"},"Teams"),"."),(0,n.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,n.kt)("img",{alt:"The Tag Key field displayed in the Virtual Tags UI; the name Teams is entered",width:"80%",src:"/img/virtual-provider-tag-key.png"})),(0,n.kt)("h6",{id:"step-2-add-tag-values-and-filters"},"Step 2: Add Tag Values and Filters"),(0,n.kt)("p",null,"You add the corresponding set of virtual tag values and filters:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"The ",(0,n.kt)("inlineCode",{parentName:"li"},"data")," team tag value corresponds with a filter for all costs for GCP BigQuery and Amazon Redshift."),(0,n.kt)("li",{parentName:"ul"},"The ",(0,n.kt)("inlineCode",{parentName:"li"},"mobile")," team tag value corresponds with a filter for its related GCP projects and AWS accounts."),(0,n.kt)("li",{parentName:"ul"},"You continue this pattern and create similar values with corresponding filters for your other teams.")),(0,n.kt)("div",{style:{display:"flex",overflow:"scroll"}},(0,n.kt)("img",{alt:"A sample Tag Value field for a value of data with filter for Service of BigQuery and Amazon Redshift",width:"60%",src:"/img/virtual-tag-provider-value-1.png"}),(0,n.kt)("img",{alt:"A sample Tag Value field for a value of data with a filter for GCP Project of mobile and AWS account of mobile",width:"60%",src:"/img/virtual-tag-provider-value-2.png"})),(0,n.kt)("p",null,"Within Cost Reports, you can easily filter and group by these tag options to easily see costs for an individual team. In the below visual example, the Cost Report is grouped by the ",(0,n.kt)("strong",{parentName:"p"},"team")," tag, and the ",(0,n.kt)("strong",{parentName:"p"},"mobile")," and ",(0,n.kt)("strong",{parentName:"p"},"data")," values are displayed along with the other team tag values you created."),(0,n.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,n.kt)("img",{alt:"A sample Cost Report grouped by Tag showing a mobile and data tag",width:"100%",src:"/img/virtual-tag-provider-report.png"})),(0,n.kt)("h5",{id:"example-2-consolidate-existing-tags"},"Example 2: Consolidate Existing Tags"),(0,n.kt)("p",null,"You have a tagging practice established at your organization, but teams often create tags with spelling variations, tags with typos, or they create duplicate tags. For example, the ",(0,n.kt)("inlineCode",{parentName:"p"},"data")," team has resources tagged with ",(0,n.kt)("inlineCode",{parentName:"p"},"data"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"Data"),", and ",(0,n.kt)("inlineCode",{parentName:"p"},"data-prod"),". This is an issue across many of your teams. You want to consolidate all these tags, across providers, into one ",(0,n.kt)("inlineCode",{parentName:"p"},"data")," tag."),(0,n.kt)("h6",{id:"step-1-create-a-new-tag-1"},"Step 1: Create a New Tag"),(0,n.kt)("p",null,"You create a tag key called ",(0,n.kt)("inlineCode",{parentName:"p"},"Teams")," to override existing tags."),(0,n.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,n.kt)("img",{alt:"The Tag Key field displayed in the Virtual Tags UI; the name Teams is entered",width:"80%",src:"/img/virtual-provider-tag-key.png"})),(0,n.kt)("h6",{id:"step-2-add-tag-values-and-filters-1"},"Step 2: Add Tag Values and Filters"),(0,n.kt)("p",null,"You add the corresponding set of virtual tag values and filters. In this example, all permutations of the ",(0,n.kt)("inlineCode",{parentName:"p"},"data")," team tag are combined into one virtual tag."),(0,n.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,n.kt)("img",{alt:"A sample Tag Value field for a value of AWS team tags equaling data, data-prod, and Data. Another value for a GCP team Label equaling data",width:"80%",src:"/img/virtual-tag-consolidate-value.png"})),(0,n.kt)("p",null,"Within Cost Reports, you can easily filter by this tag to see all costs related to the ",(0,n.kt)("inlineCode",{parentName:"p"},"data")," team. This saves you the work of needing to always filter for all permutations of this tag. Now, you need to filter by only one tag."),(0,n.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,n.kt)("img",{alt:"A Cost Report with a filter for AWS and GCP team tag of data",width:"80%",src:"/img/virtual-tag-consolidate-report.png"})),(0,n.kt)("h5",{id:"example-3-using-flexible-match-to-consolidate-similar-tag-values"},"Example 3: Using Flexible Match to Consolidate similar Tag Values"),(0,n.kt)("p",null,"Your teams have non-standardized tagging conventions that have resulted in many different forms of casing. Team A now has many different permutations of their Team tag when looking across their usage, such as ",(0,n.kt)("inlineCode",{parentName:"p"},"teamA"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"team_a"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"team-a"),", and ",(0,n.kt)("inlineCode",{parentName:"p"},"Team A")," . ",(0,n.kt)("a",{parentName:"p",href:"https://docs.vantage.sh/cost_reports/#flexible_match"},"Flexible Match")," is an easy way to match for all of these variants, as well as future variants, in a single tag configuration."),(0,n.kt)("h6",{id:"step-1-create-a-new-tag-2"},"Step 1: Create a New Tag"),(0,n.kt)("p",null,"You create a tag key called\xa0",(0,n.kt)("inlineCode",{parentName:"p"},"Teams"),"\xa0to override existing tags."),(0,n.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,n.kt)("img",{alt:"The Tag Key field displayed in the Virtual Tags UI; the name Teams is entered",width:"80%",src:"/img/virtual-provider-tag-key.png"})),(0,n.kt)("h6",{id:"step-2-add-tag-values-and-filters-2"},"Step 2: Add Tag Values and Filters"),(0,n.kt)("p",null,"Create a Virtual Tag configuration for Team A, for for Output Cost Filters, select Teams Flexible Match to the string Team A. "),(0,n.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,n.kt)("img",{alt:"A sample Tag Value field for a value of AWS Team tag flexible matches Team A",width:"80%",src:"/img/virtual-tag-flexible-match.png"})),(0,n.kt)("p",null,"This will automatically match all variants of Team A, such as ",(0,n.kt)("inlineCode",{parentName:"p"},"teamA"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"team_a"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"team-a"),", and ",(0,n.kt)("inlineCode",{parentName:"p"},"Team A")," ."),(0,n.kt)("h4",{id:"cost-based-allocation-example"},"Cost-Based Allocation Example"),(0,n.kt)("p",null,"In your organization, teams share resources, such as RDS databases or EC2 instances, and each team consumes different percentages of these resources each month. Your organization is also charged a static support fee each month for AWS. As shown in the diagram below, you want to allocate a portion of the support fee to each team based on their proportional use of AWS resources. So in the below example, since the Infra team is responsible for 50% of all AWS costs, they should also be responsible for 50% of the support fee. You can create a cost-based allocation virtual tag for allocating portions of the support fee to each respective team."),(0,n.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,n.kt)("img",{alt:"A flowchart that has the AWS logo in a block at the top. AWS has three arrows pointing to tag icons that say Infra 50%, Mobile 20%, and Data 30%. These tags point to a box that says Dynamic Cost Allocation with the icon for AWS Support. This box has three arrows that point to three boxes. The boxes say Infra Team AWS Support Costs 50%, Mobile Team AWS Support Costs 20%, and Data Team AWS Support Costs 30%.",width:"60%",src:"/img/cost-based-example.png"})),(0,n.kt)("h5",{id:"prerequisites"},"Prerequisites"),(0,n.kt)("p",null,"You have an existing provider tag in AWS that identifies resources for your teams. This tag will be used in step 2."),(0,n.kt)("h5",{id:"step-1-create-a-new-cost-based-allocation-tag"},"Step 1: Create a New Cost-Based Allocation Tag"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Navigate to ",(0,n.kt)("strong",{parentName:"li"},"Settings > Virtual Tags"),"."),(0,n.kt)("li",{parentName:"ul"},"Create a new virtual tag."),(0,n.kt)("li",{parentName:"ul"},"Select the ",(0,n.kt)("strong",{parentName:"li"},"Cost-Based")," option for the tag value.")),(0,n.kt)("h5",{id:"step-2-select-an-input-cost-filter"},"Step 2: Select an Input Cost Filter"),(0,n.kt)("p",null,"For your input cost, select ",(0,n.kt)("strong",{parentName:"p"},"All AWS Costs"),". Set an additional filter for the ",(0,n.kt)("strong",{parentName:"p"},"Usage")," charge type to filter on only usage-related costs. This filter will ignore costs related to items like credits, taxes, fees, etc."),(0,n.kt)("h5",{id:"step-3-select-a-tag-key"},"Step 3: Select a Tag Key"),(0,n.kt)("p",null,"You select your existing ",(0,n.kt)("strong",{parentName:"p"},"teams")," tag key you have in AWS that will be used for allocating costs."),(0,n.kt)("h5",{id:"step-4-select-an-output-cost-filter"},"Step 4: Select an Output Cost Filter"),(0,n.kt)("p",null,"In this example, since your infrastructure team is responsible for 50% of all AWS costs, the mobile team for 20%, and the data team for 30%, you can mimic this allocation across another static cost, or your output cost. Select the filters for the AWS support fee."),(0,n.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,n.kt)("img",{alt:"A sample Tag Value field for AWS Support Fee costs",width:"70%",src:"/img/virtual-tag-support-fee.png"})),(0,n.kt)("p",null,"Once the tag is created, create a new Cost Report and add the following criteria:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Create a filter for AWS Support costs."),(0,n.kt)("li",{parentName:"ul"},"Add grouping criteria to group by your new cost-based dynamic allocation tag.")),(0,n.kt)("p",null,"The resulting report shows how much of the support fee each team is allocated."),(0,n.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,n.kt)("img",{alt:"A sample Tag Value field for AWS Support Fee costs",width:"100%",src:"/img/virtual-tag-support-fee-report.png"})),(0,n.kt)("h4",{id:"metric-based-allocation-example"},"Business Metrics-Based Allocation Example"),(0,n.kt)("p",null,"You are working with your infrastructure team and want to ensure that the proportional cost of CPU time on a shared resource is allocated to the distinct cost centers that are consuming the CPU. In the below example, you want each team\u2019s portion of CPU usage billed as a corresponding percentage of the overall Namespace CPU cost. So, if Team A uses 30% of the resource\u2019s CPU, then they should be billed a proportional percentage of the total Namespace\u2019s costs."),(0,n.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,n.kt)("img",{alt:"A flowchart that has a CPU icon in a block at the top and says Shared Resource CPU. CPU has two arrows pointing to two boxes with people icons that say Team A CPU Usage and Team B CPU Usage. These boxes point to a box that says Total Namespace Costs with the Kubernetes icon. This box has two arrows that point to two boxes that say Portion of Namespace Costs Allocated to Team Based on Portion of CPU Usage.",width:"60%",src:"/img/metric-based-example.png"})),(0,n.kt)("h5",{id:"prerequisite"},"Prerequisite"),(0,n.kt)("p",null,"To determine the cost of CPU time to allocate to each respective team, you first create a ",(0,n.kt)("a",{parentName:"p",href:"/per_unit_costs/#labels"},"labeled business metric")," that includes the CPU time labeled by team. Vantage then calculates the respective percentage of CPU time for each team. The labeled business metric has the following format."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},"date,amount,label\n2024-01-09,825,teama\n2024-01-09,600,teamb\n2024-01-10,500,teama\n2024-01-10,200,teamb\n2024-01-11,723,teama\n2024-01-11,456,teamb\n")),(0,n.kt)("h5",{id:"step-1-create-a-new-business-metrics-based-allocation-tag"},"Step 1: Create a New Business Metrics-Based Allocation Tag"),(0,n.kt)("p",null,"You create a new business metrics-based tag:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Navigate to ",(0,n.kt)("strong",{parentName:"li"},"Settings > Virtual Tags"),"."),(0,n.kt)("li",{parentName:"ul"},"Create a new virtual tag."),(0,n.kt)("li",{parentName:"ul"},"Select the ",(0,n.kt)("strong",{parentName:"li"},"Business Metric")," option for the tag value.")),(0,n.kt)("h5",{id:"step-2-select-the-labeled-business-metric"},"Step 2: Select the Labeled Business Metric"),(0,n.kt)("p",null,"Search for and select the labeled business metric you just created to use for allocation."),(0,n.kt)("h5",{id:"step-3-select-an-output-cost-filter"},"Step 3: Select an Output Cost Filter"),(0,n.kt)("p",null,"Select the Vantage costs that will be split based on the percentages calculated in your business metric. In this case, you select a filter to show costs for the specific Namespace you want to be allocated."),(0,n.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,n.kt)("img",{alt:"A sample Tag Value field for specific Kubernetes namespace costs",width:"90%",src:"/img/virtual-tag-metric.png"})),(0,n.kt)("p",null,"Once the tag is created, create a new Cost Report and add the following criteria:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Create a filter for the specific Namespace."),(0,n.kt)("li",{parentName:"ul"},"Add grouping criteria to group by your new business metrics-based dynamic allocation tag.")),(0,n.kt)("p",null,"The resulting report shows how much of the Namespace costs each team is allocated."),(0,n.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,n.kt)("img",{alt:"A sample Tag Value field for AWS Support Fee costs",width:"100%",src:"/img/virtual-tag-metric-report.png"})),(0,n.kt)("h4",{id:"nested-virtual-tags-example"},"Nested Virtual Tags Example"),(0,n.kt)("p",null,"You want to maintain a hierarchy that reflects how your business units are associated with various applications, and track costs of all your applications per business unit over time. In addition, you also want to avoid having to manually update multiple virtual tags whenever an application changes ownership to another business unit, so you aim to set up a dynamic structure that\u2019s automatically updated."),(0,n.kt)("h5",{id:"step-1-create-an-application-virtual-tag-with-values-for-each-app"},"Step 1: Create an Application Virtual Tag with Values for Each App"),(0,n.kt)("p",null,"You create a new tag called ",(0,n.kt)("strong",{parentName:"p"},"Applications"),": "),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Each value represents a specific application (e.g., app1, app2, app3, app4)."),(0,n.kt)("li",{parentName:"ul"},"The filters for each value are AWS costs related to specific resources, like RDS or EC2 instances.")),(0,n.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,n.kt)("img",{alt:"An example of an application tag based on specific AWS resources",width:"80%",src:"/img/tags-tot-example.png"})),(0,n.kt)("h5",{id:"step-2-create-a-virtual-tag-for-business-unit-costs"},"Step 2: Create a Virtual Tag for Business Unit Costs"),(0,n.kt)("p",null,"Next, you define a virtual tag for ",(0,n.kt)("strong",{parentName:"p"},"Business Units"),":"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Each value represents a specific business unit (e.g., Core Production, Core Development)."),(0,n.kt)("li",{parentName:"ul"},"Each filter uses the preexisting ",(0,n.kt)("strong",{parentName:"li"},"Applications")," virtual tag you just created to associate specific apps with the corresponding business unit. Notice that virtual tags are denoted by a purple Vantage tag icon to differentiate them from provider tags (gray icon).")),(0,n.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,n.kt)("img",{alt:"An example of a business unit tagged associated with an existing application tag",width:"80%",src:"/img/tags-tot-example-apps.png"})),(0,n.kt)("h5",{id:"step-3-review-the-nested-virtual-tag-in-reports"},"Step 3: Review the Nested Virtual Tag in Reports"),(0,n.kt)("p",null,"In associated reports, you can track all costs per business unit, knowing that each business unit comprises a set of corresponding apps. If an app ever changes its associated business unit, you need to update only the filter criteria on the ",(0,n.kt)("strong",{parentName:"p"},"Business Units")," virtual tag, and all other costs will be processed accordingly. The below report is grouped both by business unit and application to show the total breakdown."),(0,n.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,n.kt)("img",{alt:"An example Cost Report with the Applications and Business Unit tag groupings",width:"90%",src:"/img/tags-tot-example-report.png"})),(0,n.kt)("h4",{id:"untaggable-aws"},"Tagging Untaggable Resources in AWS Example"),(0,n.kt)("p",null,"While you can apply cost and metadata tags in AWS to many resources, there are many other resources that are untaggable in AWS. Therefore, it is hard, if not almost impossible, to achieve 100% allocation in AWS alone. One quick way to first get an inventory of all untagged resources in Vantage\u2014regardless of if they are untaggable\u2014is to create a ",(0,n.kt)("a",{parentName:"p",href:"/cost_reports"},"Cost Report")," with the following filters:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Provider is ",(0,n.kt)("strong",{parentName:"li"},"AWS")),(0,n.kt)("li",{parentName:"ul"},"Where ",(0,n.kt)("strong",{parentName:"li"},"Not Tagged")," with ",(0,n.kt)("strong",{parentName:"li"},"Any Key"))),(0,n.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,n.kt)("img",{alt:"Untagged cost filters",width:"80%",src:"/img/virtual-tag-not-tagged.png"})),(0,n.kt)("p",null,"Then, add grouping criteria for ",(0,n.kt)("strong",{parentName:"p"},"Service")," and ",(0,n.kt)("strong",{parentName:"p"},"Category")," to get a view of the types of resources that are currently untagged. If these resources are taggable in AWS, you can add cost allocation tags there and see those tags represented in Vantage when you filter or group by specific tag. "),(0,n.kt)("admonition",{type:"info"},(0,n.kt)("p",{parentName:"admonition"},"See the ",(0,n.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/ARG/latest/userguide/supported-resources.html"},"AWS documentation")," for more information on what you can tag directly in AWS.")),(0,n.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,n.kt)("img",{alt:"Untagged cost filters",width:"100%",src:"/img/virtual-tag-category-tags.png"})),(0,n.kt)("p",null,"Many services and resource categories, however, cannot be tagged in AWS. You can use virtual tags to create tags in Vantage for these untaggable resources. In the table below, the ",(0,n.kt)("em",{parentName:"p"},"Vantage Resource Filters")," column represents the filters you can set as the ",(0,n.kt)("strong",{parentName:"p"},"Output Cost Filters")," in the virtual tag configuration. "),(0,n.kt)("p",null,"For example, if you want to tag S3 Data Transfer for specific resources, you could use the following filter criteria. "),(0,n.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,n.kt)("img",{alt:"Untagged cost filters",width:"80%",src:"/img/virtual-tag-data-transfer.png"})),(0,n.kt)("table",null,(0,n.kt)("thead",null,(0,n.kt)("tr",null,(0,n.kt)("th",null,"AWS Resource"),(0,n.kt)("th",null,"Description"),(0,n.kt)("th",null,"Vantage Resource Filters"))),(0,n.kt)("tbody",null,(0,n.kt)("tr",null,(0,n.kt)("td",null,"Elastic IPs"),(0,n.kt)("td",null,(0,n.kt)("a",{href:"https://docs.aws.amazon.com/vpc/latest/userguide/vpc-eip-overview.html"},"According to AWS"),', "You can tag an Elastic IP address that\'s allocated for use in a VPC, however, cost allocation tags are not supported."'),(0,n.kt)("td",null,"Provider: AWS",(0,n.kt)("br",null),(0,n.kt)("br",null),"Subcategory: Amazon Virtual Private Cloud contains ",(0,n.kt)("code",null,"inuse"))),(0,n.kt)("tr",null,(0,n.kt)("td",null,"CloudWatch Metrics"),(0,n.kt)("td",null,"CloudWatch Metrics involve performance data from AWS services, which are not taggable and are used for monitoring and alerting."),(0,n.kt)("td",null,"Provider: AWS",(0,n.kt)("br",null),(0,n.kt)("br",null),"Category: AmazonCloudWatch is Metric",(0,n.kt)("br",null),(0,n.kt)("br",null),"Further filter by resource ID")),(0,n.kt)("tr",null,(0,n.kt)("td",null,"S3 Data Transfer"),(0,n.kt)("td",null,"Data transferred in and out of S3 buckets, which is tracked but not taggable."),(0,n.kt)("td",null,"Provider: AWS",(0,n.kt)("br",null),(0,n.kt)("br",null),"Category: Amazon Simple Storage Service is Data Transfer",(0,n.kt)("br",null),(0,n.kt)("br",null),"Further filter by resource ID")),(0,n.kt)("tr",null,(0,n.kt)("td",null,"QuickSight resources"),(0,n.kt)("td",null,"Resources within Amazon QuickSight, such as dashboards and analyses, which do not support tagging."),(0,n.kt)("td",null,"Provider: AWS",(0,n.kt)("br",null),(0,n.kt)("br",null),"Service: Amazon Quicksight",(0,n.kt)("br",null),(0,n.kt)("br",null),"Optional detailed filters for Category (e.g., Business Analytics) or individual resource ID")),(0,n.kt)("tr",null,(0,n.kt)("td",null,"CloudSearch resources"),(0,n.kt)("td",null,"Amazon CloudSearch domains and their configurations, which are untaggable."),(0,n.kt)("td",null,"Provider: AWS",(0,n.kt)("br",null),(0,n.kt)("br",null),"Service: Amazon CloudSearch",(0,n.kt)("br",null),(0,n.kt)("br",null),"Optional detailed filters for Category (e.g., Data Transfer, Search Instance) or individual resource ID")),(0,n.kt)("tr",null,(0,n.kt)("td",null,"EBS Snapshot Copy"),(0,n.kt)("td",null,"Amazon EBS Snapshots that are copied between regions for Disaster Recovery or restore purposes"),(0,n.kt)("td",null,"Provider: AWS",(0,n.kt)("br",null),(0,n.kt)("br",null),"Service: Amazon Elastic Block Storage (EBS)",(0,n.kt)("br",null),(0,n.kt)("br",null),"Category: Storage Snapshot",(0,n.kt)("br",null),(0,n.kt)("br",null),"Further filter for resource ID")))))}f.isMDXComponent=!0}}]);