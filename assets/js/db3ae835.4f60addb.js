"use strict";(self.webpackChunkdocs_vantage_sh=self.webpackChunkdocs_vantage_sh||[]).push([[834],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>k});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},c=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},g=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,p=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),u=s(n),g=r,k=u["".concat(p,".").concat(g)]||u[g]||m[g]||i;return n?a.createElement(k,l(l({ref:t},c),{},{components:n})):a.createElement(k,l({ref:t},c))}));function k(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=g;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o[u]="string"==typeof e?e:r,l[1]=o;for(var s=2;s<i;s++)l[s]=n[s];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}g.displayName="MDXCreateElement"},3345:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>m,frontMatter:()=>i,metadata:()=>o,toc:()=>s});var a=n(7462),r=(n(7294),n(3905));const i={id:"connecting_azure_ea",title:"Azure EA Account",description:"This page walks through how to connect your Azure EA account to Vantage.",keywords:["Azure EA","Connect Azure"]},l="Azure EA Account",o={unversionedId:"connecting_azure_ea",id:"connecting_azure_ea",title:"Azure EA Account",description:"This page walks through how to connect your Azure EA account to Vantage.",source:"@site/docs/connecting_azure_ea.md",sourceDirName:".",slug:"/connecting_azure_ea",permalink:"/connecting_azure_ea",draft:!1,editUrl:"https://github.com/vantage-sh/docs.vantage.sh/blob/master/docs/connecting_azure_ea.md",tags:[],version:"current",frontMatter:{id:"connecting_azure_ea",title:"Azure EA Account",description:"This page walks through how to connect your Azure EA account to Vantage.",keywords:["Azure EA","Connect Azure"]},sidebar:"someSidebar",previous:{title:"Azure MCA Account",permalink:"/connecting_azure_mca"},next:{title:"Azure Services & Regions",permalink:"/azure_supported_services"}},p={},s=[{value:"Step 1: Create a New Application Registration",id:"ea-step1",level:2},{value:"Step 2: Generate a Client Secret",id:"ea-step2",level:2},{value:"Step 3: Obtain Your Billing Account ID",id:"ea-step3",level:2},{value:"Step 4: Assign Enrollment Reader Permission to the Service Principal",id:"ea-step4",level:2},{value:"Step 5: Add App Registration Credentials to Vantage",id:"ea-step5",level:2},{value:"Next Steps: Workspace Access",id:"next-steps-workspace-access",level:2}],c={toc:s},u="wrapper";function m(e){let{components:t,...n}=e;return(0,r.kt)(u,(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"azure-ea-account"},"Azure EA Account"),(0,r.kt)("p",null,"With the Azure EA integration, you allow the service principal to have access at the billing scope level."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"When you configure this integration, the Vantage service principal is granted ",(0,r.kt)("strong",{parentName:"p"},"enrollment reader")," permissions. The service principal does ",(0,r.kt)("em",{parentName:"p"},"not")," have permissions\u2014nor will it ever attempt\u2014to make any changes to your infrastructure.")),(0,r.kt)("p",null,"To integrate your Azure EA account with Vantage, follow the below steps:"),(0,r.kt)("table",null,(0,r.kt)("tr",null,(0,r.kt)("td",null,(0,r.kt)("b",null,"1")),(0,r.kt)("td",null,(0,r.kt)("a",{href:"/connecting_azure_ea#ea-step1"},"Create a new application registration"))),(0,r.kt)("tr",null,(0,r.kt)("td",null,(0,r.kt)("b",null,"2")),(0,r.kt)("td",null,(0,r.kt)("a",{href:"/connecting_azure_ea#ea-step2"},"Generate a client secret"))),(0,r.kt)("tr",null,(0,r.kt)("td",null,(0,r.kt)("b",null,"3")),(0,r.kt)("td",null,(0,r.kt)("a",{href:"/connecting_azure_ea#ea-step3"},"Obtain your billing account ID"))),(0,r.kt)("tr",null,(0,r.kt)("td",null,(0,r.kt)("b",null,"4")),(0,r.kt)("td",null,(0,r.kt)("a",{href:"/connecting_azure_ea#ea-step4"},"Assign Enrollment Reader permission to the service principal"))),(0,r.kt)("tr",null,(0,r.kt)("td",null,(0,r.kt)("b",null,"5")),(0,r.kt)("td",null,(0,r.kt)("a",{href:"/connecting_azure_ea#ea-step5"},"Add app registration credentials to Vantage"))),(0,r.kt)("tr",null,(0,r.kt)("td",null,(0,r.kt)("b",null,"6")),(0,r.kt)("td",null,(0,r.kt)("a",{href:"/connecting_azure_ea#ea-step6"},"Send your billing account ID to Vantage")))),(0,r.kt)("h2",{id:"ea-step1"},"Step 1: Create a New Application Registration"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"From the main page of the Azure portal, search for and navigate to ",(0,r.kt)("strong",{parentName:"li"},"Microsoft Entra ID"),"."),(0,r.kt)("li",{parentName:"ol"},"In the left navigation, under ",(0,r.kt)("strong",{parentName:"li"},"Manage"),", select ",(0,r.kt)("strong",{parentName:"li"},"App registrations"),"."),(0,r.kt)("li",{parentName:"ol"},"Click ",(0,r.kt)("strong",{parentName:"li"},"+ New registration"),".",(0,r.kt)("details",null,(0,r.kt)("summary",null,"Expand to view example image"),(0,r.kt)("div",null,(0,r.kt)("img",{alt:"Azure portal with App Registration menu option selected",width:"100%",src:"/img/connect-azure/azure-new-app-registration.png"})," "))),(0,r.kt)("li",{parentName:"ol"},"The ",(0,r.kt)("strong",{parentName:"li"},"Register an application")," screen is displayed. For ",(0,r.kt)("strong",{parentName:"li"},"Name"),", enter ",(0,r.kt)("em",{parentName:"li"},"vantage"),"."),(0,r.kt)("li",{parentName:"ol"},"Leave all other settings as their defaults and click ",(0,r.kt)("strong",{parentName:"li"},"Register"),".",(0,r.kt)("details",null,(0,r.kt)("summary",null,"Expand to view example image"),(0,r.kt)("div",null,(0,r.kt)("img",{alt:"Azure portal the Register an application screen and vantage entered as app name",width:"100%",src:"/img/connect-azure/azure-register-app.png"})," "))),(0,r.kt)("li",{parentName:"ol"},"The app details are displayed. Record the ",(0,r.kt)("strong",{parentName:"li"},"Application (client) ID")," and ",(0,r.kt)("strong",{parentName:"li"},"Directory (tenant) ID")," to use later.",(0,r.kt)("details",null,(0,r.kt)("summary",null,"Expand to view example image"),(0,r.kt)("div",null,(0,r.kt)("img",{alt:"Azure portal with the client ID and tenant ID displayed and highlighted",width:"100%",src:"/img/connect-azure/azure-app-ids.png"})," ")))),(0,r.kt)("h2",{id:"ea-step2"},"Step 2: Generate a Client Secret"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"On the same page, next to the ",(0,r.kt)("strong",{parentName:"li"},"Client credentials")," field, click ",(0,r.kt)("strong",{parentName:"li"},"Add a certificate or secret"),". (You can also access the ",(0,r.kt)("strong",{parentName:"li"},"Certificates and secrets")," screen from the left navigation menu.)"),(0,r.kt)("li",{parentName:"ol"},"Click ",(0,r.kt)("strong",{parentName:"li"},"+ New client secret"),"."),(0,r.kt)("li",{parentName:"ol"},"The ",(0,r.kt)("strong",{parentName:"li"},"Add a client secret")," pane is displayed. For ",(0,r.kt)("strong",{parentName:"li"},"Description"),", enter a description, such as ",(0,r.kt)("em",{parentName:"li"},"vantage-secret"),".",(0,r.kt)("details",null,(0,r.kt)("summary",null,"Expand to view example image"),(0,r.kt)("div",null,(0,r.kt)("img",{alt:"Azure portal with the Azure client secret window open and a new secreted created called vantage-secret",width:"100%",src:"/img/connect-azure/azure-client-secret.png"})," "))),(0,r.kt)("li",{parentName:"ol"},"For ",(0,r.kt)("strong",{parentName:"li"},"Expires"),", select an expiration option for the secret.",(0,r.kt)("admonition",{parentName:"li",type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"If this secret expires, you will need to supply Vantage with a new secret ",(0,r.kt)("em",{parentName:"p"},"before")," the expiration date."))),(0,r.kt)("li",{parentName:"ol"},"Click ",(0,r.kt)("strong",{parentName:"li"},"Add"),"."),(0,r.kt)("li",{parentName:"ol"},"The newly created secret is displayed. Copy the secret's ",(0,r.kt)("strong",{parentName:"li"},"Value")," to add to the Vantage console later. This value will be displayed only one time.")),(0,r.kt)("h2",{id:"ea-step3"},"Step 3: Obtain Your Billing Account ID"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Navigate to ",(0,r.kt)("strong",{parentName:"li"},"Cost Management + Billing"),"."),(0,r.kt)("li",{parentName:"ol"},"On the left menu, click ",(0,r.kt)("strong",{parentName:"li"},"Billing scopes")," and select your ",(0,r.kt)("strong",{parentName:"li"},"EA Billing Account")," from the list."),(0,r.kt)("li",{parentName:"ol"},"On the left menu, click ",(0,r.kt)("strong",{parentName:"li"},"Settings")," > ",(0,r.kt)("strong",{parentName:"li"},"Properties"),"."),(0,r.kt)("li",{parentName:"ol"},"Copy your ",(0,r.kt)("strong",{parentName:"li"},"Billing Account Id")," to add to the Vantage console later.")),(0,r.kt)("h2",{id:"ea-step4"},"Step 4: Assign Enrollment Reader Permission to the Service Principal"),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"You need to have the ",(0,r.kt)("strong",{parentName:"p"},"billing account owner")," role permissions to assign enrollment reader permissions to the service principal. The below steps are based on the ",(0,r.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/azure/cost-management-billing/manage/assign-roles-azure-service-principals"},"Azure documentation"),".")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Navigate to ",(0,r.kt)("strong",{parentName:"p"},"Microsoft Entra ID"),", then select ",(0,r.kt)("strong",{parentName:"p"},"Enterprise applications"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"From the ",(0,r.kt)("strong",{parentName:"p"},"All applications")," list, select the ",(0,r.kt)("em",{parentName:"p"},"vantage")," application you previously created."),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Expand to view example image"),(0,r.kt)("div",null,(0,r.kt)("img",{alt:"Azure portal with all apps listed in Enterprise Applications",width:"100%",src:"/img/connect-azure/azure-ea-all-apps.png"})," "),(0,r.kt)("i",null,"Source: Microsoft"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Under ",(0,r.kt)("strong",{parentName:"p"},"Properties"),", copy the ",(0,r.kt)("strong",{parentName:"p"},"Application ID")," and ",(0,r.kt)("strong",{parentName:"p"},"Object ID"),"."),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Expand to view example image"),(0,r.kt)("div",null,(0,r.kt)("img",{alt:"Azure portal with App and Object ID listed",width:"100%",src:"/img/connect-azure/azure-ea-app-id.png"})," "),(0,r.kt)("i",null,"Source: Microsoft"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Open the ",(0,r.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/rest/api/billing/role-assignments/put?view=rest-billing-2019-10-01-preview&tabs=HTTP"},(0,r.kt)("em",{parentName:"a"},"Role Assignments - Put")," article")," from the Microsoft documentation in a new tab. ")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Next to the ",(0,r.kt)("em",{parentName:"p"},"Create or update a billing role assignment")," step, click ",(0,r.kt)("strong",{parentName:"p"},"Try It"),"."),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Expand to view example image"),(0,r.kt)("div",null,(0,r.kt)("img",{alt:"Azure API role assignment sample call",width:"100%",src:"/img/connect-azure/azure-ea-role-assignment.png"})," "),(0,r.kt)("i",null,"Source: Microsoft"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"A login in screen is displayed on the right. Using your account credentials, log in to the tenant that you want to assign enrollment reader access.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"An API request form is displayed. In the ",(0,r.kt)("strong",{parentName:"p"},"Parameters")," section add the following values:"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"billingAccountName"),": Add the ",(0,r.kt)("strong",{parentName:"li"},"billing account ID")," you obtained in ",(0,r.kt)("a",{parentName:"li",href:"/connecting_azure_ea#ea-step3"},"step 3"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"billingRoleAssignmentName"),": Generate a unique GUID using the ",(0,r.kt)("a",{parentName:"li",href:"https://guidgenerator.com/"},"a GUID generator"),", as suggested by Microsoft."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"api-version"),": Use ",(0,r.kt)("inlineCode",{parentName:"li"},"2019-10-01-preview"),"."))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In the ",(0,r.kt)("strong",{parentName:"p"},"Body")," section, copy and paste the request body below. "),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n"properties": {\n   "principalId": "<YOUR_OBJECT_ID>",\n   "principalTenantId": "<YOUR_TENANT_ID>",\n   "roleDefinitionId": "/providers/Microsoft.Billing/billingAccounts/<YOUR_BILLING_ACCOUNT_ID>/billingRoleDefinitions/24f8edb6-1668-4659-b5e2-40bb5f3a7d7e"\n}\n}\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Update placeholders in the ",(0,r.kt)("strong",{parentName:"p"},"Body")," as follows:"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"principalId"),": The ",(0,r.kt)("strong",{parentName:"li"},"Object ID")," you copied at the beginning of this section."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"principalTenantId"),": Your ",(0,r.kt)("strong",{parentName:"li"},"Directory (tenant) ID")," that you copied in ",(0,r.kt)("a",{parentName:"li",href:"/connecting_azure_ea#ea-step1"},"step 1"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"roleDefinitionId"),": Replace ",(0,r.kt)("inlineCode",{parentName:"li"},"<YOUR_BILLING_ACCOUNT_ID>")," with the ",(0,r.kt)("strong",{parentName:"li"},"Billing account id")," you copied in ",(0,r.kt)("a",{parentName:"li",href:"/connecting_azure_ea#ea-step3"},"step 3"),". ",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Note that ",(0,r.kt)("inlineCode",{parentName:"li"},"24f8edb6-1668-4659-b5e2-40bb5f3a7d7e")," is the billing role definition ID for an ",(0,r.kt)("a",{parentName:"li",href:"https://learn.microsoft.com/en-us/azure/cost-management-billing/manage/assign-roles-azure-service-principals#permissions-that-can-be-assigned-to-the-service-principal"},"EnrollmentReader"),".")))),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Expand to view example image"),(0,r.kt)("div",null,(0,r.kt)("img",{alt:"Azure API role assignment parameters filled in",width:"100%",src:"/img/connect-azure/azure-ea-run.png"})," "),(0,r.kt)("i",null,"Source: Microsoft"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Click ",(0,r.kt)("strong",{parentName:"p"},"Run"),". You should see a ",(0,r.kt)("inlineCode",{parentName:"p"},"200 OK")," response, indicating that the request was successful. "),(0,r.kt)("admonition",{parentName:"li",type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"If you receive an error, see the ",(0,r.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/azure/cost-management-billing/manage/assign-roles-azure-service-principals#troubleshoot"},"Troubleshoot section")," of the Microsoft article these instructions were based on.")))),(0,r.kt)("h2",{id:"ea-step5"},"Step 5: Add App Registration Credentials to Vantage"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Navigate to the ",(0,r.kt)("a",{parentName:"li",href:"https://console.vantage.sh/settings/integrations"},"Integrations page")," in the Vantage console, and add an Azure integration."),(0,r.kt)("li",{parentName:"ol"},"On the Azure integration page, click ",(0,r.kt)("strong",{parentName:"li"},"Add Credentials"),"."),(0,r.kt)("li",{parentName:"ol"},"Add the following credentials:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"For ",(0,r.kt)("strong",{parentName:"li"},"Azure AD Tenant ID"),", add the ",(0,r.kt)("strong",{parentName:"li"},"Directory (tenant) ID")," you obtained in ",(0,r.kt)("a",{parentName:"li",href:"/connecting_azure_ea#ea-step1"},"step 1"),"."),(0,r.kt)("li",{parentName:"ul"},"For ",(0,r.kt)("strong",{parentName:"li"},"Service Principal App ID"),", add the ",(0,r.kt)("strong",{parentName:"li"},"Application (client) ID")," you obtained in ",(0,r.kt)("a",{parentName:"li",href:"/connecting_azure_ea#ea-step1"},"step 1"),"."),(0,r.kt)("li",{parentName:"ul"},"For ",(0,r.kt)("strong",{parentName:"li"},"Service Principal Password"),", add the client secret you obtained in ",(0,r.kt)("a",{parentName:"li",href:"/connecting_azure_ea#ea-step2"},"step 2"),"."),(0,r.kt)("li",{parentName:"ul"},"For ",(0,r.kt)("strong",{parentName:"li"},"Billing Account Id"),", add the ",(0,r.kt)("strong",{parentName:"li"},"Billing Account Id")," you obtained in ",(0,r.kt)("a",{parentName:"li",href:"/connecting_azure_ea#ea-step3"},"step 3"),"."))),(0,r.kt)("li",{parentName:"ol"},"Click ",(0,r.kt)("strong",{parentName:"li"},"Connect Account"),".")),(0,r.kt)("p",null,"Vantage will begin importing your Azure costs."),(0,r.kt)("h2",{id:"next-steps-workspace-access"},"Next Steps: Workspace Access"),(0,r.kt)("p",null,"See the ",(0,r.kt)("a",{parentName:"p",href:"/connecting_azure#workspace-access"},"Workspace Access")," section on the main ",(0,r.kt)("em",{parentName:"p"},"Connecting Azure")," page for information on how to assign this integration to one or more workspaces."))}m.isMDXComponent=!0}}]);